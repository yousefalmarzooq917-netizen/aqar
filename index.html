<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙƒØªØ¨ Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <style>
        /* === Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (ÙƒØ­Ù„ÙŠ ÙˆØ°Ù‡Ø¨ÙŠ Ø¯Ø§ÙØ¦ / Ø²ÙˆØ§ÙŠØ§ Ù†Ø§Ø¹Ù…Ø©) === */
        :root {
            --primary: #1e3c72;         
            --secondary: #f2a65a;       
            --bg: #f5f7fa;              
            --card-bg: #ffffff;
            --text: #2c3e50;
            --border: #e2e8f0;
            --shadow: rgba(30, 60, 114, 0.08); 
            --radius: 18px;             
            --transition: 0.3s ease-in-out;
        }
        [data-theme="dark"] {
            --primary: #4e8cf5;         
            --secondary: #f5b97b;
            --bg: #0f172a;              
            --card-bg: #1e293b;
            --text: #f1f5f9;
            --border: #334155;
            --shadow: rgba(0,0,0,0.5);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { font-family: 'Almarai', sans-serif; background-color: var(--bg); color: var(--text); transition: background-color var(--transition), color var(--transition); padding-bottom: 80px; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø­Ø³Ù† Ù„Ù„Ø¬ÙˆØ§Ù„ */
        header { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 20px; position: relative; text-align: center; border-bottom: 5px solid var(--secondary); display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        
        .top-nav { width: 100%; max-width: 1200px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .top-nav-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .nav-btn { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; height: 42px; padding: 0 16px; border-radius: 12px; cursor: pointer; font-family: 'Almarai'; font-size: 14px; font-weight: bold; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 6px; backdrop-filter: blur(8px); }
        .nav-btn:hover { background: var(--secondary); color: #1e3c72; border-color: var(--secondary); transform: translateY(-2px); }
        .nav-btn-highlight { background: var(--secondary); color: #1e3c72; border: none; box-shadow: 0 4px 10px rgba(242, 166, 90, 0.4); }

        .logo { width: 105px; height: 105px; border-radius: 50%; border: 4px solid var(--secondary); background: white; margin-bottom: 15px; box-shadow: 0 8px 15px rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center; transition: var(--transition); }
        .logo:hover { transform: scale(1.05); }
        .logo svg { width: 55px; height: 55px; fill: var(--primary); }

        /* === Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± === */
        .header-contact-links { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px; width: 100%; max-width: 800px; }
        .contact-badge-group { display: flex; align-items: center; background: rgba(255,255,255,0.1); border-radius: 50px; padding: 5px; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .contact-badge-title { padding: 0 12px; font-size: 13px; font-weight: bold; color: white; white-space: nowrap; }
        .h-btn { display: flex; align-items: center; justify-content: center; gap: 5px; padding: 8px 16px; border-radius: 50px; font-size: 13px; font-weight: bold; text-decoration: none; color: white; transition: 0.2s; white-space: nowrap; }
        .h-btn:hover { transform: translateY(-2px); }
        .h-btn.wa-btn { background: #25d366; }
        .h-btn.wa-btn:hover { background: #1ebe57; }
        .h-btn.wa-btn-alt { background: #128C7E; }
        .h-btn.wa-btn-alt:hover { background: #075E54; }
        .h-btn.call-btn { background: var(--secondary); color: #1e3c72; margin-inline-start: 5px; }
        .h-btn.call-btn:hover { background: #fce2c2; }
        
        /* ØªÙˆØ§ÙÙ‚ Ø§Ù„Ù‡ÙŠØ¯Ø± Ù…Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 650px) { 
            .top-nav { justify-content: center; }
            .top-nav-group { justify-content: center; }
            .contact-badge-group { flex-direction: column; border-radius: 18px; padding: 12px; width: 100%; gap: 10px; } 
            .contact-badge-title { margin-bottom: 5px; font-size: 15px; } 
            .h-btn { width: 100%; height: 45px; font-size: 15px; } 
            .h-btn.call-btn { margin-inline-start: 0; }
        }

        .container { width: 100%; max-width: 1200px; margin: -20px auto 30px; padding: 0 15px; position: relative; z-index: 10; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel { display: none; background: var(--card-bg); border: 1px solid var(--border); padding: 30px; border-radius: var(--radius); margin-bottom: 30px; box-shadow: 0 15px 35px var(--shadow); }
        #adminPanel h2 { font-size: 22px; color: var(--primary); margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px dashed var(--border); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px; }
        
        .admin-form-group { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        @media (max-width: 768px) { .admin-form-group { grid-template-columns: 1fr; } }
        
        .input-wrapper { display: flex; flex-direction: column; gap: 8px; }
        .input-wrapper.full-width { grid-column: 1 / -1; }
        label { font-weight: bold; font-size: 14px; color: var(--text); }
        .admin-input { width: 100%; height: 50px; padding: 0 15px; font-size: 15px; border: 2px solid var(--border); border-radius: 12px; font-family: 'Almarai'; background: var(--bg); color: var(--text); outline: none; transition: 0.3s; }
        .admin-input:focus { border-color: var(--primary); background: var(--card-bg); box-shadow: 0 0 0 4px rgba(30, 60, 114, 0.1); }
        textarea.admin-input { height: 120px; padding: 15px; resize: vertical; }

        .image-admin-section { background: var(--bg); border: 2px dashed var(--border); padding: 20px; border-radius: var(--radius); display: flex; flex-direction: column; gap: 15px; }
        #existingImgsContainer { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .edit-img-wrapper { position: relative; width: 90px; height: 90px; flex-shrink: 0; border-radius: 10px; overflow: hidden; border: 2px solid var(--border); }
        .edit-img-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .edit-img-wrapper button { position: absolute; top: 4px; right: 4px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

        .form-actions { display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap; }
        .btn-save, .btn-cancel { flex: 1; min-width: 150px; height: 55px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; font-family: 'Almarai'; display: flex; justify-content: center; align-items: center; gap: 8px; transition: var(--transition); border: none; }
        .btn-save { background: var(--primary); color: white; box-shadow: 0 6px 15px rgba(30, 60, 114, 0.25); }
        .btn-save:hover { background: #162d56; transform: translateY(-3px); }
        .btn-cancel { background: transparent; color: var(--text); border: 2px solid var(--border); }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--border); }
        .stat-item { background: var(--bg); padding: 20px 10px; border-radius: 16px; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; }
        .stat-item span.lbl { font-size: 13px; color: var(--text); opacity: 0.7; font-weight: bold; }
        .stat-item span.val { font-size: 28px; font-weight: 800; color: var(--primary); line-height: 1; }
        @media (max-width: 600px) { .stats-grid { grid-template-columns: 1fr; } }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª (Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ±) Ù…Ø¹Ø¯Ù„ Ù„Ù„Ø¬ÙˆØ§Ù„ */
        .toolbar { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 12px; margin-bottom: 30px; align-items: center; background: var(--card-bg); padding: 20px; border-radius: var(--radius); border: 1px solid var(--border); box-shadow: 0 8px 25px var(--shadow); }
        .toolbar .admin-input { height: 50px; margin: 0; border-width: 2px; }
        .view-icons { display: flex; gap: 10px; height: 50px; justify-content: flex-end; }
        .view-btn { width: 50px; height: 50px; background: var(--bg); color: var(--text); border: 2px solid var(--border); border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: var(--transition); }
        .view-btn.active, .view-btn:hover { background: var(--secondary); border-color: var(--secondary); color: #1e3c72; }
        
        @media (max-width: 1024px) {
            .toolbar { grid-template-columns: 1fr 1fr; }
            .view-icons { grid-column: 1 / -1; justify-content: center; }
        }
        @media (max-width: 600px) {
            .toolbar { grid-template-columns: 1fr; }
            .view-icons { grid-column: 1 / -1; justify-content: stretch; }
            .view-btn { flex: 1; }
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .prop-grid { display: grid; gap: 20px; }
        .grid-view { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        .list-view { grid-template-columns: 1fr; }
        
        .prop-card { background: var(--card-bg); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border); box-shadow: 0 10px 30px var(--shadow); display: flex; flex-direction: column; position: relative; transition: transform 0.3s; }
        .prop-card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(30, 60, 114, 0.15); }
        
        .list-view .prop-card { flex-direction: row; height: 250px; }
        .list-view .prop-img-wrapper { width: 40%; height: 100%; }
        .list-view .prop-details { flex: 1; justify-content: space-between; }
        @media (max-width: 768px) { .list-view .prop-card { flex-direction: column; height: auto; } .list-view .prop-img-wrapper { width: 100%; height: 220px; } }

        .prop-img-wrapper { width: 100%; height: 230px; position: relative; }
        .prop-img-wrapper img { width: 100%; height: 100%; object-fit: cover; display: block; }
        
        .status-tag { position: absolute; top: 15px; right: 15px; padding: 6px 16px; border-radius: 20px; color: white; font-weight: bold; font-size: 12px; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .tag-avail { background: linear-gradient(135deg, #10b981, #059669); } .tag-sold { background: linear-gradient(135deg, #ef4444, #dc2626); } .tag-arch { background: #94a3b8; }
        .views-tag { position: absolute; top: 15px; left: 15px; background: rgba(30, 60, 114, 0.9); color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; z-index: 10; display: flex; align-items: center; gap: 5px; }

        .prop-details { padding: 20px; display: flex; flex-direction: column; flex: 1; gap: 15px; }
        .prop-header { display: flex; flex-direction: column; gap: 6px; }
        .prop-neigh { font-size: 13px; color: var(--text); opacity: 0.6; display: flex; align-items: center; gap: 5px; font-weight: bold; }
        .prop-title { font-size: 18px; font-weight: 800; margin: 0; color: var(--text); line-height: 1.4; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px; }
        
        .op-tag { font-size: 12px; padding: 4px 8px; border-radius: 6px; font-weight: bold; color: white; white-space: nowrap; }
        .op-sale { background: var(--primary); }
        .op-rent { background: var(--secondary); color: #1e3c72; }

        .prop-price-area { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); margin-top: auto; flex-wrap: wrap; gap: 10px; }
        .prop-price { font-size: 20px; font-weight: 800; color: var(--primary); }
        [data-theme="dark"] .prop-price { color: var(--secondary); }
        .prop-area { font-size: 13px; color: var(--text); background: var(--bg); padding: 6px 12px; border-radius: 8px; font-weight: bold; }

        .card-actions { display: flex; gap: 10px; width: 100%; flex-wrap: wrap; }
        .btn-action { flex: 1; min-width: 100px; height: 45px; border-radius: 10px; font-size: 14px; font-weight: bold; font-family: 'Almarai'; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; border: none; transition: var(--transition); }
        .btn-details { background: var(--primary); color: white; }
        .btn-details:hover { background: #162d56; }
        .btn-share { background: transparent; color: var(--text); border: 2px solid var(--border); }
        
        .admin-actions { display: flex; gap: 10px; width: 100%; }
        .btn-edit { flex: 1; background: rgba(242, 166, 90, 0.15); color: #d97706; border: none; }
        .btn-delete { flex: 1; background: rgba(239, 68, 68, 0.1); color: #ef4444; border: none; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.85); z-index: 4000; align-items: center; justify-content: center; padding: 15px; backdrop-filter: blur(8px); }
        .modal-content { background: var(--card-bg); width: 100%; max-width: 850px; max-height: 95vh; border-radius: 20px; display: flex; flex-direction: column; position: relative; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); overflow: hidden; }
        .modal-header { padding: 20px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: var(--bg); }
        .modal-header h3 { margin: 0; font-size: 20px; color: var(--primary); font-weight: 800; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .close-btn { font-size: 32px; cursor: pointer; line-height: 1; color: var(--text); opacity: 0.5; transition: 0.2s; border: none; background: transparent; padding: 0 10px; }
        .close-btn:hover { opacity: 1; color: #ef4444; }
        .modal-body { padding: 25px; overflow-y: auto; flex: 1; }
        
        .details-gallery { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 20px; scroll-snap-type: x mandatory; }
        .details-gallery img { height: 300px; min-width: 85%; object-fit: cover; border-radius: 12px; cursor: pointer; scroll-snap-align: center; border: 1px solid var(--border); }
        @media (max-width: 600px) { .details-gallery img { height: 220px; min-width: 95%; } }

        .details-price-area { display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, var(--bg), var(--card-bg)); padding: 20px; border-radius: 16px; margin-bottom: 20px; border: 1px solid var(--border); flex-wrap: wrap; gap: 15px; }
        .details-price-area .price { font-size: 26px; font-weight: 900; color: var(--primary); }
        [data-theme="dark"] .details-price-area .price { color: var(--secondary); }
        .details-price-area .area { font-size: 15px; font-weight: bold; color: var(--text); background: var(--card-bg); padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border); }

        .details-desc { font-size: 16px; line-height: 1.9; color: var(--text); margin-bottom: 25px; white-space: pre-wrap; padding: 0 5px; }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ - Ø¹Ù…ÙˆØ¯ÙŠØ© (ØªØ­Øª Ø¨Ø¹Ø¶) */
        .details-actions { display: flex; flex-direction: column; gap: 12px; margin-top: auto; }
        .btn-whatsapp { width: 100%; height: 55px; background: #25d366; color: white; border-radius: 12px; display: flex; justify-content: center; align-items: center; text-decoration: none; font-weight: bold; font-size: 16px; gap: 10px; transition: 0.2s; }
        .btn-whatsapp:hover { background: #1ebe57; transform: translateY(-2px); }
        .btn-wa-admin { background: #128C7E; } /* Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© */
        .btn-wa-admin:hover { background: #075E54; }
        
        .btn-map { width: 100%; height: 55px; background: #f1f5f9; color: #334155; border: 2px solid #cbd5e1; border-radius: 12px; display: flex; justify-content: center; align-items: center; text-decoration: none; font-weight: bold; font-size: 16px; gap: 10px; transition: 0.2s; }
        .btn-map:hover { background: #e2e8f0; color: #0f172a; border-color: #94a3b8; }
        [data-theme="dark"] .btn-map { background: transparent; color: #f1f5f9; border-color: #475569; }

        /* Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± Lightbox */
        #lightboxModal { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95); z-index: 6000; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        #lightboxImg { max-width: 95vw; max-height: 85vh; border-radius: 12px; object-fit: contain; }
        .lightbox-close { position: absolute; top: 20px; right: 25px; font-size: 45px; color: white; cursor: pointer; line-height: 1; z-index: 6010; opacity: 0.8; }
        .lightbox-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 50px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; color: white; font-size: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; z-index: 6010; }
        .lightbox-prev { left: 15px; } .lightbox-next { right: 15px; }

        /* Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-box { background: var(--card-bg); padding: 35px 25px; border-radius: 20px; width: 100%; max-width: 400px; text-align: center; display: flex; flex-direction: column; gap: 15px; }
        .login-box h2 { color: var(--primary); margin-bottom: 10px; font-size: 22px; }

        /* Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… (ÙŠÙ…ÙŠÙ† Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©) */
        .floating-wa-container { position: fixed; bottom: 25px; right: 25px; display: flex; flex-direction: column; gap: 15px; z-index: 1000; }
        .floating-wa { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(0,0,0,0.25); text-decoration: none; transition: 0.3s; color: white; background: #25d366; }
        .floating-wa:hover { transform: scale(1.1) translateY(-5px); }
    </style>
</head>
<body data-theme="light">

    <div id="lightboxModal">
        <span class="lightbox-close" onclick="closeLightbox()">Ã—</span>
        <button class="lightbox-nav lightbox-prev" onclick="changeLightboxImg(-1)">â®</button>
        <img id="lightboxImg" src="">
        <button class="lightbox-nav lightbox-next" onclick="changeLightboxImg(1)">â¯</button>
    </div>

    <div id="loginModal" class="modal-overlay">
        <div class="login-box">
            <h2>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
            <input type="text" id="userInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="admin-input">
            <input type="password" id="passInput" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ" class="admin-input">
            <div class="form-actions" style="margin-top: 10px;">
                <button class="btn-save" onclick="checkLogin()">Ø¯Ø®ÙˆÙ„</button>
                <button class="btn-cancel" onclick="closeLogin()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <div id="detailsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detTitle">Ø§Ù„ØªÙØ§ØµÙŠÙ„</h3>
                <button class="close-btn" onclick="closeDetails()">Ã—</button>
            </div>
            <div class="modal-body" id="detailsContent"></div>
        </div>
    </div>

    <div class="floating-wa-container">
        <a href="https://wa.me/966590100077" class="floating-wa" target="_blank" title="ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª">
            <svg viewBox="0 0 24 24" width="34" height="34" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
            </svg>
        </a>
    </div>

    <header>
        <div class="top-nav">
            <div class="top-nav-group">
                <button class="nav-btn" onclick="toggleLanguage()" id="langBtn">ğŸŒ EN</button>
                <button class="nav-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™</button>
            </div>
            <div class="top-nav-group">
                <button class="nav-btn" onclick="window.open('http://google.com/maps')">ğŸ“ Ù…ÙˆÙ‚Ø¹Ù†Ø§</button>
                <button class="nav-btn nav-btn-highlight" onclick="showLogin()" id="adminBtn">ğŸ‘¤ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
            </div>
        </div>
        
        <div class="logo">
            <svg viewBox="0 0 24 24"><path d="M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3zm0 2.7l5 4.5V18h-2v-6H9v6H7v-7.8l5-4.5z"/></svg>
        </div>
        
        <h1 style="margin-bottom: 8px; font-size: 28px; font-weight: 800; line-height: 1.3;">Ù…ÙƒØªØ¨ Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</h1>
        <p style="opacity: 0.9; font-size: 16px; font-weight: 300;">Ø¨ÙˆØ§Ø¨ØªÙƒ Ø§Ù„Ø¹ØµØ±ÙŠØ© Ù„Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø£Ù†Ø³Ø¨</p>

        <div class="header-contact-links">
            <div class="contact-badge-group">
                <span class="contact-badge-title">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</span>
                <a href="https://wa.me/966590100077" target="_blank" class="h-btn wa-btn">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
                <a href="tel:0590100077" class="h-btn call-btn">ğŸ“ Ø§ØªØµØ§Ù„</a>
            </div>
            <div class="contact-badge-group">
                <span class="contact-badge-title">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</span>
                <a href="https://wa.me/966590002216" target="_blank" class="h-btn wa-btn-alt">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
                <a href="tel:0590002216" class="h-btn call-btn">ğŸ“ Ø§ØªØµØ§Ù„</a>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="adminPanel">
            <h2>
                <span>âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
                <button onclick="injectDummyData()" style="font-size:12px; padding:8px 12px; background:var(--secondary); border:none; border-radius:8px; cursor:pointer; font-weight:bold; color:#1e3c72; margin-top: 10px;">+ Ø¥Ø¯Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            </h2>
            <form id="propForm">
                <input type="hidden" id="editId">
                <div class="admin-form-group">
                    
                    <div class="input-wrapper">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¶ (Ø¨ÙŠØ¹ / Ø¥ÙŠØ¬Ø§Ø±)</label>
                        <select id="f_op" class="admin-input" required>
                            <option value="Ø¨ÙŠØ¹" selected>Ø¨ÙŠØ¹</option>
                            <option value="Ø¥ÙŠØ¬Ø§Ø±">Ø¥ÙŠØ¬Ø§Ø±</option>
                        </select>
                    </div>

                    <div class="input-wrapper">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
                        <select id="f_type" class="admin-input" required>
                            <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...</option>
                            <option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
                            <option value="Ø´Ù‚Ø©">Ø´Ù‚Ø©</option>
                            <option value="Ø£Ø±Ø¶">Ø£Ø±Ø¶</option>
                            <option value="Ø¹Ù…Ø§Ø±Ø©">Ø¹Ù…Ø§Ø±Ø©</option>
                            <option value="Ù…Ø²Ø±Ø¹Ø©">Ù…Ø²Ø±Ø¹Ø©</option>
                            <option value="Ù†Øµ Ø£Ø±Ø¶">Ù†Øµ Ø£Ø±Ø¶</option>
                            <option value="Ø£Ø±Ø§Ø¶ÙŠ Ù…ØªØ¬Ø§ÙˆØ±Ø©">Ø£Ø±Ø§Ø¶ÙŠ Ù…ØªØ¬Ø§ÙˆØ±Ø©</option>
                            <option value="Ù…Ø­Ù„">Ù…Ø­Ù„</option>
                            <option value="Ø¯ÙˆØ¨Ù„ÙƒØ³">Ø¯ÙˆØ¨Ù„ÙƒØ³</option>
                            <option value="Ù…Ù†Ø²Ù„">Ù…Ù†Ø²Ù„</option>
                            <option value="Ù…Ù†ØªØ¬Ø¹">Ù…Ù†ØªØ¬Ø¹</option>
                            <option value="Ø£Ø³Ù‡Ù…">Ø£Ø³Ù‡Ù…</option>
                            <option value="Ù…Ø®Ø·Ø·Ø§Øª">Ù…Ø®Ø·Ø·Ø§Øª</option>
                        </select>
                    </div>
                    
                    <div class="input-wrapper"><label>Ø§Ù„Ø­ÙŠ</label><input type="text" id="f_neigh" class="admin-input" required placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ..."></div>
                    <div class="input-wrapper"><label>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</label><input type="text" id="f_area" class="admin-input" placeholder="Ù…Ø«Ø§Ù„: 300Ù…"></div>
                    <div class="input-wrapper"><label>Ø§Ù„Ø³Ø¹Ø±</label><input type="text" id="f_price" class="admin-input" required placeholder="Ù…Ø«Ø§Ù„: 1,500,000 Ø±ÙŠØ§Ù„"></div>
                    <div class="input-wrapper"><label>Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
                        <select id="f_status" class="admin-input">
                            <option value="Ù…ØªØ§Ø­">Ù…ØªØ§Ø­</option>
                            <option value="Ù…Ø¨Ø§Ø¹">Ù…Ø¨Ø§Ø¹</option>
                            <option value="Ù…Ø­Ø¬ÙˆØ²">Ù…Ø­Ø¬ÙˆØ²</option>
                            <option value="Ù…Ø¤Ø±Ø´Ù">Ù…Ø¤Ø±Ø´Ù</option>
                        </select>
                    </div>
                    <div class="input-wrapper full-width"><label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input type="text" id="f_map" class="admin-input" placeholder="Ø±Ø§Ø¨Ø· Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„"></div>
                    
                    <div class="input-wrapper full-width">
                        <label>ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</label>
                        <textarea id="f_details" class="admin-input" placeholder="Ø¹Ù…Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±ØŒ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©ØŒ Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù..."></textarea>
                    </div>
                </div>

                <div class="image-admin-section">
                    <div class="admin-form-group" style="margin-bottom: 0;">
                        <div class="input-wrapper"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø³Ø±ÙŠ)</label><input type="text" id="f_owner" class="admin-input"></div>
                        <div class="input-wrapper"><label>Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø³Ø±ÙŠ)</label><input type="text" id="f_phone" class="admin-input"></div>
                    </div>
                    
                    <div class="input-wrapper full-width">
                        <label>Ø§Ù„ØµÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ã— Ù„Ù„Ø­Ø°Ù):</label>
                        <div id="existingImgsContainer"></div>
                    </div>
                    
                    <div class="input-wrapper full-width">
                        <label>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©:</label>
                        <input type="file" id="f_imgs" multiple class="admin-input" accept="image/*" style="padding: 12px;">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="cancelEdit()">Ø¥Ù„ØºØ§Ø¡ ÙˆØ§Ù„ØªÙØ±ÙŠØº</button>
                    <button type="submit" class="btn-save" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±</button>
                </div>
            </form>

            <div class="stats-grid">
                <div class="stat-item"><span class="lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</span><span class="val" id="s_total">0</span></div>
                <div class="stat-item"><span class="lbl">Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ø±Ø¶</span><span class="val" id="s_avail">0</span></div>
                <div class="stat-item"><span class="lbl">Ø§Ù„Ù…Ø¨Ø§Ø¹</span><span class="val" id="s_sold">0</span></div>
            </div>
        </div>

        <div class="toolbar">
            <input type="text" id="searchBox" class="admin-input" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø­ÙŠ Ø£Ùˆ Ø§Ù„ØªÙØ§ØµÙŠÙ„..." onkeyup="filterContent()">
            
            <select id="filterOp" class="admin-input" onchange="filterContent()">
                <option value="Ø§Ù„ÙƒÙ„">ÙƒÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶</option>
                <option value="Ø¨ÙŠØ¹">Ø¨ÙŠØ¹</option>
                <option value="Ø¥ÙŠØ¬Ø§Ø±">Ø¥ÙŠØ¬Ø§Ø±</option>
            </select>

            <select id="filterType" class="admin-input" onchange="filterContent()">
                <option value="Ø§Ù„ÙƒÙ„">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                <option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
                <option value="Ø´Ù‚Ø©">Ø´Ù‚Ø©</option>
                <option value="Ø£Ø±Ø¶">Ø£Ø±Ø¶</option>
                <option value="Ø¹Ù…Ø§Ø±Ø©">Ø¹Ù…Ø§Ø±Ø©</option>
                <option value="Ù…Ø²Ø±Ø¹Ø©">Ù…Ø²Ø±Ø¹Ø©</option>
                <option value="Ù†Øµ Ø£Ø±Ø¶">Ù†Øµ Ø£Ø±Ø¶</option>
                <option value="Ø£Ø±Ø§Ø¶ÙŠ Ù…ØªØ¬Ø§ÙˆØ±Ø©">Ø£Ø±Ø§Ø¶ÙŠ Ù…ØªØ¬Ø§ÙˆØ±Ø©</option>
                <option value="Ù…Ø­Ù„">Ù…Ø­Ù„</option>
                <option value="Ø¯ÙˆØ¨Ù„ÙƒØ³">Ø¯ÙˆØ¨Ù„ÙƒØ³</option>
                <option value="Ù…Ù†Ø²Ù„">Ù…Ù†Ø²Ù„</option>
                <option value="Ù…Ù†ØªØ¬Ø¹">Ù…Ù†ØªØ¬Ø¹</option>
                <option value="Ø£Ø³Ù‡Ù…">Ø£Ø³Ù‡Ù…</option>
                <option value="Ù…Ø®Ø·Ø·Ø§Øª">Ù…Ø®Ø·Ø·Ø§Øª</option>
            </select>

            <select id="filterNeigh" class="admin-input" onchange="filterContent()">
                <option value="Ø§Ù„ÙƒÙ„">ÙƒÙ„ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</option>
            </select>
            
            <div class="view-icons">
                <button class="view-btn active" id="btnGrid" onclick="setView('grid')">â¬œ</button>
                <button class="view-btn" id="btnList" onclick="setView('list')">â˜°</button>
            </div>
        </div>

        <div id="mainGrid" class="prop-grid grid-view"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAbzqda0NFaj3nAotHK9_1exNqNDeRASxk",
            authDomain: "alfateh-aqar.firebaseapp.com",
            projectId: "alfateh-aqar",
            storageBucket: "alfateh-aqar.firebasestorage.app",
            messagingSenderId: "170214550520",
            appId: "1:170214550520:web:638dfbc62ea5edc7cc040d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let isAdmin = false;
        let allData = [];
        let currentEditImgs = []; 
        let lightboxImgs = []; 
        let lightboxIndex = 0;

        function showLogin() { 
            if(isAdmin) { location.reload(); }
            else { document.getElementById('loginModal').style.display='flex'; }
        }
        function closeLogin() { document.getElementById('loginModal').style.display='none'; }
        function checkLogin() {
            if(document.getElementById('userInput').value === "admin" && document.getElementById('passInput').value === "1234") {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminBtn').innerHTML = 'ğŸ‘¤ Ø®Ø±ÙˆØ¬';
                closeLogin();
                renderAll();
            } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©"); }
        }

        async function loadData() {
            const snap = await db.collection('properties').orderBy('timestamp', 'desc').get();
            allData = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
            
            populateNeighborhoods();
            updateStats();
            renderAll();
        }

        function populateNeighborhoods() {
            const neighSelect = document.getElementById('filterNeigh');
            const currentVal = neighSelect.value;
            
            const uniqueNeighs = [...new Set(allData.map(item => item.neigh).filter(Boolean))];
            
            let options = '<option value="Ø§Ù„ÙƒÙ„">ÙƒÙ„ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</option>';
            uniqueNeighs.forEach(n => {
                options += `<option value="${n}">${n}</option>`;
            });
            
            neighSelect.innerHTML = options;
            neighSelect.value = uniqueNeighs.includes(currentVal) ? currentVal : "Ø§Ù„ÙƒÙ„";
        }

        function updateStats() {
            document.getElementById('s_total').innerText = allData.length;
            document.getElementById('s_avail').innerText = allData.filter(i => i.status === 'Ù…ØªØ§Ø­').length;
            document.getElementById('s_sold').innerText = allData.filter(i => i.status === 'Ù…Ø¨Ø§Ø¹').length;
        }

        function renderAll(data = allData) {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = '';
            
            if(data.length === 0) {
                grid.innerHTML = '<h3 style="text-align:center; grid-column:1/-1; color:var(--text); opacity:0.5; padding:50px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø±Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</h3>';
                return;
            }

            data.forEach(item => {
                if(item.status === 'Ù…Ø¤Ø±Ø´Ù' && !isAdmin) return;
                
                const statusClass = item.status === 'Ù…ØªØ§Ø­' ? 'tag-avail' : (item.status === 'Ù…Ø¨Ø§Ø¹' ? 'tag-sold' : 'tag-arch');
                const opType = item.op || 'Ø¨ÙŠØ¹'; 
                const opClass = opType === 'Ø¥ÙŠØ¬Ø§Ø±' ? 'op-rent' : 'op-sale';
                
                const card = document.createElement('div');
                card.className = 'prop-card';
                card.innerHTML = `
                    <div class="prop-img-wrapper">
                        ${isAdmin ? `<div class="views-tag">ğŸ‘ï¸ ${item.views || 0}</div>` : ''}
                        <div class="status-tag ${statusClass}">${item.status}</div>
                        <img src="${item.imgs?.[0] || 'https://via.placeholder.com/600x400?text=Ø¨Ø¯ÙˆÙ†+ØµÙˆØ±Ø©'}" loading="lazy">
                    </div>
                    <div class="prop-details">
                        <div class="prop-header">
                            <span class="prop-neigh">ğŸ“ ${item.neigh}</span>
                            <h3 class="prop-title">
                                ${item.type}
                                <span class="op-tag ${opClass}">${opType}</span>
                            </h3>
                        </div>
                        
                        <div class="prop-price-area">
                            <span class="prop-price">${item.price}</span>
                            <span class="prop-area">ğŸ“ ${item.area || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        
                        <div class="card-actions">
                            <button class="btn-action btn-share" onclick="shareMe('${item.type}','${item.neigh}')">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©</button>
                            <button class="btn-action btn-details" onclick="openDetails('${item.id}')">Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                        </div>
                        
                        ${isAdmin ? `
                        <div class="admin-actions">
                            <button class="btn-action btn-edit" onclick="editItem('${item.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn-action btn-delete" onclick="deleteItem('${item.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>` : ''}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function openLightbox(idx) {
            lightboxIndex = idx;
            document.getElementById('lightboxImg').src = lightboxImgs[lightboxIndex];
            document.getElementById('lightboxModal').style.display = 'flex';
        }
        function closeLightbox() { document.getElementById('lightboxModal').style.display = 'none'; }
        function changeLightboxImg(step) {
            lightboxIndex = (lightboxIndex + step + lightboxImgs.length) % lightboxImgs.length;
            document.getElementById('lightboxImg').src = lightboxImgs[lightboxIndex];
        }

        async function openDetails(id) {
            const item = allData.find(i => i.id === id);
            if(!isAdmin) await db.collection('properties').doc(id).update({ views: firebase.firestore.FieldValue.increment(1) });
            
            lightboxImgs = item.imgs || [];
            let galleryHTML = '<div class="details-gallery">';
            lightboxImgs.forEach((src, idx) => {
                galleryHTML += `<img src="${src}" onclick="openLightbox(${idx})">`;
            });
            galleryHTML += '</div>';

            const opType = item.op || 'Ø¨ÙŠØ¹';
            document.getElementById('detTitle').innerHTML = `${item.type} ÙÙŠ ${item.neigh} <span style="font-size:13px; background:var(--secondary); color:#1e3c72; padding:4px 10px; border-radius:8px; margin-inline-start:10px;">${opType}</span>`;
            
            const waSvg = `<svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>`;

            document.getElementById('detailsContent').innerHTML = `
                ${lightboxImgs.length > 0 ? galleryHTML : ''}
                
                <div class="details-price-area">
                    <span class="price">${item.price}</span>
                    <span class="area">ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${item.area || '-'}</span>
                </div>
                
                <div class="details-desc">${item.details || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©.'}</div>
                
                ${isAdmin ? `
                <div style="background: rgba(242, 166, 90, 0.15); padding: 15px; border-radius: 12px; margin-bottom: 25px; font-size: 14px; border: 1px dashed var(--secondary);">
                    <b style="color:#d97706;">ğŸ”’ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø±ÙŠØ© Ù„Ù„Ù…ÙˆØ¸Ù:</b><br>
                    <div style="margin-top:8px;"><b>Ø§Ù„Ù…Ø§Ù„Ùƒ:</b> ${item.ownerName || '-'}</div>
                    <div><b>Ø§Ù„Ø¬ÙˆØ§Ù„:</b> ${item.ownerPhone || '-'}</div>
                    <div style="margin-top:5px; padding-top:5px; border-top:1px solid rgba(0,0,0,0.1);"><b>Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª:</b> ${item.views || 0} ğŸ‘ï¸</div>
                </div>` : ''}
                
                <div class="details-actions">
                    <a href="https://wa.me/966590100077?text=Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† ${item.type} (${opType}) ÙÙŠ ${item.neigh} Ø¨Ø³Ø¹Ø± ${item.price}" target="_blank" class="btn-whatsapp">
                        ${waSvg} ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (0590100077)
                    </a>
                    <a href="https://wa.me/966590002216?text=Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† ${item.type} (${opType}) ÙÙŠ ${item.neigh} Ø¨Ø³Ø¹Ø± ${item.price}" target="_blank" class="btn-whatsapp btn-wa-admin">
                        ${waSvg} ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (0590002216)
                    </a>
                    ${item.map ? `<a href="${item.map}" target="_blank" class="btn-map">ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>` : ''}
                </div>
            `;
            document.getElementById('detailsModal').style.display = 'flex';
        }

        function closeDetails() { document.getElementById('detailsModal').style.display = 'none'; }

        function renderEditImgs() {
            const container = document.getElementById('existingImgsContainer');
            container.innerHTML = '';
            if(currentEditImgs.length === 0) container.innerHTML = '<span style="color:var(--text); opacity:0.6; font-size:14px; padding:10px 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ø­Ø§Ù„ÙŠØ§Ù‹.</span>';
            currentEditImgs.forEach((src, idx) => {
                const div = document.createElement('div');
                div.className = 'edit-img-wrapper';
                div.innerHTML = `<img src="${src}"><button type="button" onclick="removeImgFromEdit(${idx})">Ã—</button>`;
                container.appendChild(div);
            });
        }
        function removeImgFromEdit(idx) {
            currentEditImgs.splice(idx, 1);
            renderEditImgs();
        }

        async function compressImg(file) {
            return new Promise(res => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = e => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = 1000;
                        canvas.height = img.height * (1000 / img.width);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        
                        ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
                        ctx.font = "bold 40px Almarai";
                        ctx.shadowColor = "rgba(0,0,0,0.5)";
                        ctx.shadowBlur = 5;
                        ctx.fillText("Ù…ÙƒØªØ¨ Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©", 30, 60);
                        
                        res(canvas.toDataURL('image/jpeg', 0.7));
                    }
                }
            });
        }

        document.getElementById('propForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            btn.disabled = true; btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";

            const id = document.getElementById('editId').value;
            const files = document.getElementById('f_imgs').files;
            
            let newImgs = [];
            for (let f of files) newImgs.push(await compressImg(f));

            const finalImgsArray = [...currentEditImgs, ...newImgs];

            const data = {
                type: document.getElementById('f_type').value,
                op: document.getElementById('f_op').value, 
                neigh: document.getElementById('f_neigh').value,
                area: document.getElementById('f_area').value,
                price: document.getElementById('f_price').value,
                status: document.getElementById('f_status').value,
                map: document.getElementById('f_map').value,
                details: document.getElementById('f_details').value,
                ownerName: document.getElementById('f_owner').value,
                ownerPhone: document.getElementById('f_phone').value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                imgs: finalImgsArray
            };
            if(id) await db.collection('properties').doc(id).update(data);
            else { data.views = 0; await db.collection('properties').add(data); }

            cancelEdit();
            loadData();
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
            btn.disabled = false;
            btn.innerHTML = "ğŸ’¾ Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±";
        };

        function editItem(id) {
            const item = allData.find(i => i.id === id);
            document.getElementById('editId').value = item.id;
            
            ['type','op','neigh','area','price','status','map','details'].forEach(k => {
                if(document.getElementById('f_'+k)) {
                    document.getElementById('f_'+k).value = item[k] || (k==='op'?'Ø¨ÙŠØ¹':'');
                }
            });
            document.getElementById('f_owner').value = item.ownerName || '';
            document.getElementById('f_phone').value = item.ownerPhone || '';
            currentEditImgs = item.imgs ? [...item.imgs] : [];
            renderEditImgs();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelEdit() {
            document.getElementById('propForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('f_type').value = ''; 
            document.getElementById('f_op').value = 'Ø¨ÙŠØ¹'; 
            currentEditImgs = [];
            renderEditImgs();
        }

        async function deleteItem(id) {
            if(confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ")) { await db.collection('properties').doc(id).delete(); loadData(); }
        }

        function filterContent() {
            const searchVal = document.getElementById('searchBox').value.toLowerCase();
            const typeVal = document.getElementById('filterType').value;
            const opVal = document.getElementById('filterOp').value;
            const neighVal = document.getElementById('filterNeigh').value;

            const filtered = allData.filter(i => {
                const matchSearch = (i.details && i.details.toLowerCase().includes(searchVal)) || (i.neigh && i.neigh.toLowerCase().includes(searchVal));
                const matchType = typeVal === 'Ø§Ù„ÙƒÙ„' || (i.type && i.type === typeVal);
                const itemOp = i.op || 'Ø¨ÙŠØ¹'; 
                const matchOp = opVal === 'Ø§Ù„ÙƒÙ„' || itemOp === opVal;
                const matchNeigh = neighVal === 'Ø§Ù„ÙƒÙ„' || (i.neigh && i.neigh === neighVal);

                return matchSearch && matchType && matchOp && matchNeigh;
            });
            renderAll(filtered);
        }

        function setView(v) {
            document.getElementById('mainGrid').className = 'prop-grid ' + (v==='grid'?'grid-view':'list-view');
            document.getElementById('btnGrid').classList.toggle('active', v==='grid');
            document.getElementById('btnList').classList.toggle('active', v==='list');
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeBtn').innerText = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function shareMe(t, n) { 
            if(navigator.share) navigator.share({title: t, text: `Ø¹Ù‚Ø§Ø± ÙÙŠ ${n}`, url: window.location.href});
            else alert("Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©: " + window.location.href);
        }

        async function injectDummyData() {
            if(!confirm("Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© 3 Ø¹Ù‚Ø§Ø±Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØµÙ…ÙŠÙ…. Ù‡Ù„ ØªÙˆØ§ÙÙ‚ØŸ")) return;
            
            const dummy = [
                { type: 'Ø¯ÙˆØ¨Ù„ÙƒØ³', neigh: 'Ø§Ù„ÙÙŠØµÙ„ÙŠØ©', area: '400Ù…', price: '1,200,000 Ø±ÙŠØ§Ù„', status: 'Ù…ØªØ§Ø­', map: '', details: 'Ø¯ÙˆØ¨Ù„ÙƒØ³ Ù…ØªØµÙ„ØŒ ÙˆØ§Ø¬Ù‡Ø© Ø´Ø±Ù‚ÙŠØ©ØŒ ÙŠØªÙƒÙˆÙ† Ù…Ù† Ø¯ÙˆØ±ÙŠÙ† ÙˆÙ…Ù„Ø­Ù‚.', ownerName: 'Ù…Ø­Ù…Ø¯', ownerPhone: '0500000000', op: 'Ø¨ÙŠØ¹', views: 45, timestamp: firebase.firestore.FieldValue.serverTimestamp() },
                { type: 'Ù…Ø­Ù„', neigh: 'Ø§Ù„Ø¶Ø¨Ø§Ø¨', area: '80Ù…', price: '45,000 Ø±ÙŠØ§Ù„ / Ø³Ù†ÙˆÙŠ', status: 'Ù…ØªØ§Ø­', map: '', details: 'Ù…Ø­Ù„ Ø¹Ù„Ù‰ Ø´Ø§Ø±Ø¹ ØªØ¬Ø§Ø±ÙŠ Ø­ÙŠÙˆÙŠ 30 Ù…ØªØ±ØŒ Ù…Ø¬Ù‡Ø² Ø¨Ø¯ÙŠÙƒÙˆØ±Ø§Øª.', ownerName: 'Ø®Ø§Ù„Ø¯', ownerPhone: '0500000001', op: 'Ø¥ÙŠØ¬Ø§Ø±', views: 12, timestamp: firebase.firestore.FieldValue.serverTimestamp() },
                { type: 'Ù…Ù†ØªØ¬Ø¹', neigh: 'Ø§Ù„ÙØ±Ø³Ø§Ù†', area: '1200Ù…', price: '3,500,000 Ø±ÙŠØ§Ù„', status: 'Ù…ØªØ§Ø­', map: '', details: 'Ù…Ù†ØªØ¬Ø¹ Ø±Ø§Ù‚ÙŠ Ù…Ø¬Ù‡Ø² Ø¨Ù…Ø³Ø¨Ø­ØŒ Ù…Ø³Ø·Ø­Ø§Øª Ø®Ø¶Ø±Ø§Ø¡ØŒ ÙˆÙ…Ø¬Ø§Ù„Ø³ ÙØ§Ø®Ø±Ø©.', ownerName: 'Ø´Ø±ÙƒØ© Ø¹Ù‚Ø§Ø±', ownerPhone: '0500000002', op: 'Ø¨ÙŠØ¹', views: 88, timestamp: firebase.firestore.FieldValue.serverTimestamp() }
            ];
            
            for(let d of dummy) {
                await db.collection('properties').add(d);
            }
            alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!");
            loadData(); 
        }

        loadData();
    </script>
</body>
</html>
