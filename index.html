<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙƒØªØ¨ Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø¹Ù‚Ø§Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #113f28; --secondary: #d4af37; --bg: #f4f6f9; --card-bg: #ffffff;
            --text: #333; --border: #e0e0e0; --shadow: rgba(0,0,0,0.08);
            --radius: 12px; --transition: 0.3s ease;
        }
        [data-theme="dark"] {
            --primary: #1a5c3a; --secondary: #f1c40f; --bg: #121212; --card-bg: #1e1e1e;
            --text: #e0e0e0; --border: #333; --shadow: rgba(0,0,0,0.4);
        }
        
        /* ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ§Ù„Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„ØµØ§Ø±Ù…Ø© Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { font-family: 'Almarai', sans-serif; background-color: var(--bg); color: var(--text); transition: background-color var(--transition), color var(--transition); padding-bottom: 80px; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { background: linear-gradient(135deg, var(--primary), #0a291a); color: white; padding: 40px 20px; position: relative; text-align: center; border-bottom: 4px solid var(--secondary); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .logo { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--secondary); object-fit: cover; background: white; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        
        .top-nav { position: absolute; top: 20px; left: 20px; right: 20px; display: flex; justify-content: space-between; align-items: center; z-index: 100; pointer-events: none; }
        .top-nav-group { display: flex; gap: 10px; pointer-events: auto; }
        .nav-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; height: 40px; padding: 0 15px; border-radius: 8px; cursor: pointer; font-family: 'Almarai'; font-size: 14px; font-weight: bold; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 5px; backdrop-filter: blur(5px); }
        .nav-btn:hover { background: var(--secondary); color: black; border-color: var(--secondary); }
        .nav-btn-highlight { background: var(--secondary); color: black; border: none; }

        .container { width: 100%; max-width: 1200px; margin: 30px auto; padding: 0 20px; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© */
        #adminPanel { display: none; background: var(--card-bg); border: 1px solid var(--border); padding: 30px; border-radius: var(--radius); margin-bottom: 30px; box-shadow: 0 8px 25px var(--shadow); }
        #adminPanel h2 { font-size: 24px; color: var(--primary); margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        
        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ØªÙ…Ø§Ø«Ù„Ø© */
        .admin-form-group { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px; }
        @media (max-width: 768px) { .admin-form-group { grid-template-columns: 1fr; } }
        
        .input-wrapper { display: flex; flex-direction: column; gap: 8px; }
        .input-wrapper.full-width { grid-column: 1 / -1; }
        label { font-weight: bold; font-size: 14px; color: var(--text); }
        .admin-input { width: 100%; height: 50px; padding: 0 15px; font-size: 15px; border: 1px solid var(--border); border-radius: 8px; font-family: 'Almarai'; background: var(--bg); color: var(--text); outline: none; transition: border-color 0.2s; }
        .admin-input:focus { border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2); }
        textarea.admin-input { height: 120px; padding: 15px; resize: vertical; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ± */
        .image-admin-section { background: rgba(0,0,0,0.02); border: 1px dashed var(--border); padding: 20px; border-radius: var(--radius); display: flex; flex-direction: column; gap: 15px; }
        [data-theme="dark"] .image-admin-section { background: rgba(255,255,255,0.02); }
        #existingImgsContainer { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 5px; }
        .edit-img-wrapper { position: relative; width: 100px; height: 100px; flex-shrink: 0; border-radius: 8px; overflow: hidden; border: 1px solid var(--border); }
        .edit-img-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .edit-img-wrapper button { position: absolute; top: 5px; right: 5px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); transition: transform 0.2s; }
        .edit-img-wrapper button:hover { transform: scale(1.1); }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ Ù…ØªÙ…Ø§Ø«Ù„Ø© 50/50 */
        .form-actions { display: flex; gap: 15px; margin-top: 30px; }
        .btn-save, .btn-cancel { flex: 1; height: 55px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; font-family: 'Almarai'; display: flex; justify-content: center; align-items: center; gap: 8px; transition: var(--transition); border: none; }
        .btn-save { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(17, 63, 40, 0.3); }
        .btn-save:hover { background: #0a291a; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(17, 63, 40, 0.4); }
        .btn-cancel { background: transparent; color: var(--text); border: 1px solid var(--border); }
        .btn-cancel:hover { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }

        /* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--border); }
        .stat-item { background: var(--bg); border: 1px solid var(--border); padding: 25px 15px; border-radius: var(--radius); text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; }
        .stat-item span.lbl { font-size: 14px; color: var(--text); opacity: 0.8; }
        .stat-item span.val { font-size: 32px; font-weight: 800; color: var(--primary); line-height: 1; }
        @media (max-width: 600px) { .stats-grid { grid-template-columns: 1fr; } }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø¨Ù…Ø­Ø§Ø°Ø§Ø© Ù…Ø«Ø§Ù„ÙŠØ© */
        .toolbar { display: grid; grid-template-columns: 1fr 200px auto; gap: 15px; margin-bottom: 30px; align-items: center; background: var(--card-bg); padding: 15px; border-radius: var(--radius); border: 1px solid var(--border); box-shadow: 0 4px 15px var(--shadow); }
        .toolbar .admin-input { height: 50px; margin: 0; }
        .view-icons { display: flex; gap: 10px; height: 50px; }
        .view-btn { width: 50px; height: 50px; background: var(--bg); color: var(--text); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: var(--transition); }
        .view-btn.active, .view-btn:hover { background: var(--secondary); border-color: var(--secondary); color: black; }
        @media (max-width: 768px) { .toolbar { grid-template-columns: 1fr; } .view-icons { justify-content: stretch; } .view-btn { flex: 1; } }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒØ±ÙˆØª */
        .prop-grid { display: grid; gap: 20px; }
        .grid-view { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
        .list-view { grid-template-columns: 1fr; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ±Øª */
        .prop-card { background: var(--card-bg); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border); box-shadow: 0 4px 15px var(--shadow); display: flex; flex-direction: column; position: relative; transition: transform 0.2s, box-shadow 0.2s; }
        .prop-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px var(--shadow); }
        
        .list-view .prop-card { flex-direction: row; height: 260px; }
        .list-view .prop-img-wrapper { width: 35%; height: 100%; }
        .list-view .prop-details { flex: 1; justify-content: space-between; }
        @media (max-width: 768px) { .list-view .prop-card { flex-direction: column; height: auto; } .list-view .prop-img-wrapper { width: 100%; height: 220px; } }

        .prop-img-wrapper { width: 100%; height: 220px; position: relative; }
        .prop-img-wrapper img { width: 100%; height: 100%; object-fit: cover; display: block; }
        
        .status-tag { position: absolute; top: 15px; right: 15px; padding: 6px 14px; border-radius: 20px; color: white; font-weight: bold; font-size: 12px; z-index: 10; letter-spacing: 0.5px; }
        .tag-avail { background: #27ae60; } .tag-sold { background: #e74c3c; } .tag-arch { background: #95a5a6; }
        .views-tag { position: absolute; top: 15px; left: 15px; background: rgba(212, 175, 55, 0.95); color: black; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; z-index: 10; display: flex; align-items: center; gap: 5px; }

        .prop-details { padding: 20px; display: flex; flex-direction: column; flex: 1; gap: 15px; }
        .prop-header { display: flex; flex-direction: column; gap: 5px; }
        .prop-neigh { font-size: 13px; color: var(--text); opacity: 0.7; display: flex; align-items: center; gap: 5px; }
        .prop-title { font-size: 18px; font-weight: 800; margin: 0; color: var(--text); line-height: 1.4; }
        
        /* Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙˆØ§Ù„Ø³Ø¹Ø± Ù…ØªÙ…Ø§Ø«Ù„ÙŠÙ† */
        .prop-price-area { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-top: 1px dashed var(--border); border-bottom: 1px dashed var(--border); margin-top: auto; }
        .prop-price { font-size: 20px; font-weight: 800; color: var(--primary); }
        [data-theme="dark"] .prop-price { color: var(--secondary); }
        .prop-area { font-size: 14px; color: var(--text); background: var(--bg); padding: 5px 12px; border-radius: 6px; border: 1px solid var(--border); font-weight: bold; }

        /* Ø£Ø²Ø±Ø§Ø± Ù…ØªÙ…Ø§Ø«Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ±Øª */
        .card-actions { display: flex; gap: 10px; width: 100%; }
        .btn-action { flex: 1; height: 44px; border-radius: 8px; font-size: 14px; font-weight: bold; font-family: 'Almarai'; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; border: none; transition: var(--transition); }
        .btn-details { background: var(--primary); color: white; }
        .btn-details:hover { background: #0a291a; }
        .btn-share { background: var(--bg); color: var(--text); border: 1px solid var(--border); }
        .btn-share:hover { background: var(--border); }
        
        .admin-actions { display: flex; gap: 10px; width: 100%; }
        .btn-edit { flex: 1; background: rgba(212, 175, 55, 0.1); color: #b8860b; border: 1px solid #d4af37; }
        .btn-edit:hover { background: #d4af37; color: white; }
        .btn-delete { flex: 1; background: rgba(231, 76, 60, 0.1); color: #e74c3c; border: 1px solid #e74c3c; }
        .btn-delete:hover { background: #e74c3c; color: white; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù…Ù†ØªØµÙ Ø¨Ø¯Ù‚Ø©) */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 4000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); width: 100%; max-width: 800px; max-height: 90vh; border-radius: var(--radius); display: flex; flex-direction: column; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.5); overflow: hidden; }
        .modal-header { padding: 20px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: var(--bg); }
        .modal-header h3 { margin: 0; font-size: 20px; color: var(--primary); }
        .close-btn { font-size: 28px; cursor: pointer; line-height: 1; color: var(--text); opacity: 0.7; transition: 0.2s; border: none; background: transparent; }
        .close-btn:hover { opacity: 1; color: #e74c3c; }
        .modal-body { padding: 25px; overflow-y: auto; flex: 1; }
        
        .details-gallery { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 20px; scroll-snap-type: x mandatory; }
        .details-gallery img { height: 300px; min-width: 80%; object-fit: cover; border-radius: 8px; cursor: pointer; scroll-snap-align: center; border: 1px solid var(--border); }
        @media (max-width: 600px) { .details-gallery img { height: 220px; min-width: 90%; } }

        .details-price-area { display: flex; justify-content: space-between; align-items: center; background: var(--bg); padding: 20px; border-radius: var(--radius); margin-bottom: 20px; border: 1px solid var(--border); }
        .details-price-area .price { font-size: 28px; font-weight: 800; color: var(--secondary); }
        .details-price-area .area { font-size: 16px; font-weight: bold; color: var(--text); display: flex; align-items: center; gap: 8px; }

        .details-desc { font-size: 16px; line-height: 1.8; color: var(--text); margin-bottom: 25px; white-space: pre-wrap; }
        
        .details-actions { display: flex; gap: 15px; margin-top: auto; }
        .btn-whatsapp { flex: 2; height: 55px; background: #25d366; color: white; border-radius: 8px; display: flex; justify-content: center; align-items: center; text-decoration: none; font-weight: bold; font-size: 16px; gap: 10px; transition: 0.2s; }
        .btn-whatsapp:hover { background: #1ebe57; transform: translateY(-2px); }
        .btn-map { flex: 1; height: 55px; background: #4285F4; color: white; border-radius: 8px; display: flex; justify-content: center; align-items: center; text-decoration: none; font-weight: bold; font-size: 16px; gap: 10px; transition: 0.2s; }
        .btn-map:hover { background: #3367d6; transform: translateY(-2px); }

        /* Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± Lightbox */
        #lightboxModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 6000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        #lightboxImg { max-width: 90vw; max-height: 85vh; border-radius: 8px; object-fit: contain; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .lightbox-close { position: absolute; top: 25px; right: 30px; font-size: 40px; color: white; cursor: pointer; line-height: 1; z-index: 6010; }
        .lightbox-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 60px; height: 60px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 50%; color: white; font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; backdrop-filter: blur(4px); z-index: 6010; }
        .lightbox-nav:hover { background: var(--secondary); color: black; border-color: var(--secondary); }
        .lightbox-prev { left: 20px; }
        .lightbox-next { right: 20px; }

        /* Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-box { background: var(--card-bg); padding: 40px; border-radius: var(--radius); width: 100%; max-width: 400px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); display: flex; flex-direction: column; gap: 15px; }
        .login-box h2 { color: var(--primary); margin-bottom: 10px; }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        .floating-wa { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: #25d366; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); z-index: 1000; text-decoration: none; transition: 0.2s; }
        .floating-wa:hover { transform: scale(1.1); }
    </style>
</head>
<body data-theme="light">

    <div id="lightboxModal">
        <span class="lightbox-close" onclick="closeLightbox()">Ã—</span>
        <button class="lightbox-nav lightbox-prev" onclick="changeLightboxImg(-1)">â®</button>
        <img id="lightboxImg" src="">
        <button class="lightbox-nav lightbox-next" onclick="changeLightboxImg(1)">â¯</button>
    </div>

    <div id="loginModal" class="modal-overlay">
        <div class="login-box">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <input type="text" id="userInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="admin-input">
            <input type="password" id="passInput" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ" class="admin-input">
            <div class="form-actions" style="margin-top: 10px;">
                <button class="btn-save" onclick="checkLogin()">Ø¯Ø®ÙˆÙ„</button>
                <button class="btn-cancel" onclick="closeLogin()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <div id="detailsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detTitle">Ø§Ù„ØªÙØ§ØµÙŠÙ„</h3>
                <button class="close-btn" onclick="closeDetails()">Ã—</button>
            </div>
            <div class="modal-body" id="detailsContent">
                </div>
        </div>
    </div>

    <a href="https://wa.me/966590002216" class="floating-wa" target="_blank" title="ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§">ğŸ’¬</a>

    <header>
        <div class="top-nav">
            <div class="top-nav-group">
                <button class="nav-btn" onclick="toggleLanguage()" id="langBtn">ğŸŒ EN</button>
                <button class="nav-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™</button>
            </div>
            <div class="top-nav-group">
                <button class="nav-btn" onclick="window.open('http://google.com/maps')">ğŸ“ Ù…ÙˆÙ‚Ø¹Ù†Ø§</button>
                <button class="nav-btn nav-btn-highlight" onclick="showLogin()" id="adminBtn">ğŸ‘¤ Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>
        <img src="https://c.top4top.io/p_37048y9xn1.jpg" class="logo" alt="Logo">
        <h1 style="margin-bottom: 5px;">Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø¹Ù‚Ø§Ø±</h1>
        <p style="opacity: 0.85; font-size: 16px;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
    </header>

    <div class="container">
        <div id="adminPanel">
            <h2>âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
            <form id="propForm">
                <input type="hidden" id="editId">
                <div class="admin-form-group">
                    <div class="input-wrapper"><label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label><input type="text" id="f_type" class="admin-input" required placeholder="Ù…Ø«Ø§Ù„: ÙÙŠÙ„Ø§ØŒ Ø´Ù‚Ø©..."></div>
                    <div class="input-wrapper"><label>Ø§Ù„Ø­ÙŠ</label><input type="text" id="f_neigh" class="admin-input" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ"></div>
                    <div class="input-wrapper"><label>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</label><input type="text" id="f_area" class="admin-input" placeholder="Ù…Ø«Ø§Ù„: 300Ù…"></div>
                    <div class="input-wrapper"><label>Ø§Ù„Ø³Ø¹Ø±</label><input type="text" id="f_price" class="admin-input" required placeholder="Ù…Ø«Ø§Ù„: 1,500,000 Ø±ÙŠØ§Ù„"></div>
                    <div class="input-wrapper"><label>Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
                        <select id="f_status" class="admin-input">
                            <option value="Ù…ØªØ§Ø­">Ù…ØªØ§Ø­</option>
                            <option value="Ù…Ø¨Ø§Ø¹">Ù…Ø¨Ø§Ø¹</option>
                            <option value="Ù…Ø­Ø¬ÙˆØ²">Ù…Ø­Ø¬ÙˆØ²</option>
                            <option value="Ù…Ø¤Ø±Ø´Ù">Ù…Ø¤Ø±Ø´Ù</option>
                        </select>
                    </div>
                    <div class="input-wrapper"><label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input type="text" id="f_map" class="admin-input" placeholder="Ø±Ø§Ø¨Ø· Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„"></div>
                    
                    <div class="input-wrapper full-width">
                        <label>ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</label>
                        <textarea id="f_details" class="admin-input" placeholder="Ø¹Ù…Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±ØŒ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©ØŒ Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù..."></textarea>
                    </div>
                </div>

                <div class="image-admin-section">
                    <div class="admin-form-group" style="margin-bottom: 0;">
                        <div class="input-wrapper"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø³Ø±ÙŠ)</label><input type="text" id="f_owner" class="admin-input"></div>
                        <div class="input-wrapper"><label>Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø³Ø±ÙŠ)</label><input type="text" id="f_phone" class="admin-input"></div>
                    </div>
                    
                    <div class="input-wrapper full-width">
                        <label>Ø§Ù„ØµÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ã— Ù„Ù„Ø­Ø°Ù):</label>
                        <div id="existingImgsContainer"></div>
                    </div>
                    
                    <div class="input-wrapper full-width">
                        <label>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©:</label>
                        <input type="file" id="f_imgs" multiple class="admin-input" accept="image/*" style="padding: 10px;">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="cancelEdit()">Ø¥Ù„ØºØ§Ø¡ ÙˆØ§Ù„ØªÙØ±ÙŠØº</button>
                    <button type="submit" class="btn-save" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±</button>
                </div>
            </form>

            <div class="stats-grid">
                <div class="stat-item"><span class="lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</span><span class="val" id="s_total">0</span></div>
                <div class="stat-item"><span class="lbl">Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ø±Ø¶</span><span class="val" id="s_avail">0</span></div>
                <div class="stat-item"><span class="lbl">Ø§Ù„Ù…Ø¨Ø§Ø¹</span><span class="val" id="s_sold">0</span></div>
            </div>
        </div>

        <div class="toolbar">
            <input type="text" id="searchBox" class="admin-input" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­ÙŠØŒ Ù†ÙˆØ¹ØŒ Ø£Ùˆ ØªÙØ§ØµÙŠÙ„..." onkeyup="filterContent()">
            <select id="filterType" class="admin-input" onchange="filterContent()">
                <option value="Ø§Ù„ÙƒÙ„">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                <option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
                <option value="Ø´Ù‚Ø©">Ø´Ù‚Ø©</option>
                <option value="Ø£Ø±Ø¶">Ø£Ø±Ø¶</option>
                <option value="Ø¹Ù…Ø§Ø±Ø©">Ø¹Ù…Ø§Ø±Ø©</option>
            </select>
            <div class="view-icons">
                <button class="view-btn active" id="btnGrid" onclick="setView('grid')">â¬œ</button>
                <button class="view-btn" id="btnList" onclick="setView('list')">â˜°</button>
            </div>
        </div>

        <div id="mainGrid" class="prop-grid grid-view"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAbzqda0NFaj3nAotHK9_1exNqNDeRASxk",
            authDomain: "alfateh-aqar.firebaseapp.com",
            projectId: "alfateh-aqar",
            storageBucket: "alfateh-aqar.firebasestorage.app",
            messagingSenderId: "170214550520",
            appId: "1:170214550520:web:638dfbc62ea5edc7cc040d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let isAdmin = false;
        let allData = [];
        let currentEditImgs = []; 
        let lightboxImgs = []; 
        let lightboxIndex = 0;

        function showLogin() { 
            if(isAdmin) { location.reload(); }
            else { document.getElementById('loginModal').style.display='flex'; }
        }
        function closeLogin() { document.getElementById('loginModal').style.display='none'; }
        function checkLogin() {
            if(document.getElementById('userInput').value === "admin" && document.getElementById('passInput').value === "1234") {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminBtn').innerHTML = 'ğŸ‘¤ Ø®Ø±ÙˆØ¬';
                closeLogin();
                renderAll();
            } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©"); }
        }

        async function loadData() {
            const snap = await db.collection('properties').orderBy('timestamp', 'desc').get();
            allData = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
            updateStats();
            renderAll();
        }

        function updateStats() {
            document.getElementById('s_total').innerText = allData.length;
            document.getElementById('s_avail').innerText = allData.filter(i => i.status === 'Ù…ØªØ§Ø­').length;
            document.getElementById('s_sold').innerText = allData.filter(i => i.status === 'Ù…Ø¨Ø§Ø¹').length;
        }

        function renderAll(data = allData) {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = '';
            data.forEach(item => {
                if(item.status === 'Ù…Ø¤Ø±Ø´Ù' && !isAdmin) return;
                
                const statusClass = item.status === 'Ù…ØªØ§Ø­' ? 'tag-avail' : (item.status === 'Ù…Ø¨Ø§Ø¹' ? 'tag-sold' : 'tag-arch');
                
                const card = document.createElement('div');
                card.className = 'prop-card';
                card.innerHTML = `
                    <div class="prop-img-wrapper">
                        ${isAdmin ? `<div class="views-tag">ğŸ‘ï¸ ${item.views || 0}</div>` : ''}
                        <div class="status-tag ${statusClass}">${item.status}</div>
                        <img src="${item.imgs?.[0] || 'https://via.placeholder.com/600x400'}" loading="lazy">
                    </div>
                    <div class="prop-details">
                        <div class="prop-header">
                            <span class="prop-neigh">ğŸ“ ${item.neigh}</span>
                            <h3 class="prop-title">${item.type}</h3>
                        </div>
                        
                        <div class="prop-price-area">
                            <span class="prop-price">${item.price}</span>
                            <span class="prop-area">ğŸ“ ${item.area || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        
                        <div class="card-actions">
                            <button class="btn-action btn-share" onclick="shareMe('${item.type}','${item.neigh}')">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©</button>
                            <button class="btn-action btn-details" onclick="openDetails('${item.id}')">Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                        </div>
                        
                        ${isAdmin ? `
                        <div class="admin-actions">
                            <button class="btn-action btn-edit" onclick="editItem('${item.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn-action btn-delete" onclick="deleteItem('${item.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>` : ''}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Lightbox)
        function openLightbox(idx) {
            lightboxIndex = idx;
            document.getElementById('lightboxImg').src = lightboxImgs[lightboxIndex];
            document.getElementById('lightboxModal').style.display = 'flex';
        }
        function closeLightbox() { document.getElementById('lightboxModal').style.display = 'none'; }
        function changeLightboxImg(step) {
            lightboxIndex = (lightboxIndex + step + lightboxImgs.length) % lightboxImgs.length;
            document.getElementById('lightboxImg').src = lightboxImgs[lightboxIndex];
        }

        async function openDetails(id) {
            const item = allData.find(i => i.id === id);
            if(!isAdmin) await db.collection('properties').doc(id).update({ views: firebase.firestore.FieldValue.increment(1) });
            
            lightboxImgs = item.imgs || [];
            let galleryHTML = '<div class="details-gallery">';
            lightboxImgs.forEach((src, idx) => {
                galleryHTML += `<img src="${src}" onclick="openLightbox(${idx})">`;
            });
            galleryHTML += '</div>';

            document.getElementById('detTitle').innerText = `${item.type} ÙÙŠ ${item.neigh}`;
            
            document.getElementById('detailsContent').innerHTML = `
                ${lightboxImgs.length > 0 ? galleryHTML : ''}
                
                <div class="details-price-area">
                    <span class="price">${item.price}</span>
                    <span class="area">ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${item.area || '-'}</span>
                </div>
                
                <div class="details-desc">${item.details || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©.'}</div>
                
                ${isAdmin ? `
                <div style="background: rgba(212,175,55,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; border: 1px solid var(--secondary);">
                    <b>ğŸ”’ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø±ÙŠØ© Ù„Ù„Ù…ÙˆØ¸Ù:</b><br>
                    Ø§Ù„Ù…Ø§Ù„Ùƒ: ${item.ownerName || '-'}<br>
                    Ø§Ù„Ø¬ÙˆØ§Ù„: ${item.ownerPhone || '-'}<br>
                    Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª: ${item.views || 0}
                </div>` : ''}
                
                <div class="details-actions">
                    <a href="https://wa.me/966590002216?text=Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† ${item.type} ÙÙŠ ${item.neigh} Ø¨Ø³Ø¹Ø± ${item.price}" target="_blank" class="btn-whatsapp">ğŸ’¬ ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨</a>
                    ${item.map ? `<a href="${item.map}" target="_blank" class="btn-map">ğŸ“ Ø®Ø±ÙŠØ·Ø©</a>` : ''}
                </div>
            `;
            document.getElementById('detailsModal').style.display = 'flex';
        }

        function closeDetails() { document.getElementById('detailsModal').style.display = 'none'; }

        // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„ØµÙˆØ±
        function renderEditImgs() {
            const container = document.getElementById('existingImgsContainer');
            container.innerHTML = '';
            if(currentEditImgs.length === 0) container.innerHTML = '<span style="color:#888; font-size:14px; padding:10px 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ø­Ø§Ù„ÙŠØ§Ù‹.</span>';
            currentEditImgs.forEach((src, idx) => {
                const div = document.createElement('div');
                div.className = 'edit-img-wrapper';
                div.innerHTML = `<img src="${src}"><button type="button" onclick="removeImgFromEdit(${idx})">Ã—</button>`;
                container.appendChild(div);
            });
        }
        function removeImgFromEdit(idx) {
            currentEditImgs.splice(idx, 1);
            renderEditImgs();
        }

        async function compressImg(file) {
            return new Promise(res => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = e => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = 1000;
                        canvas.height = img.height * (1000 / img.width);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
                        ctx.font = "bold 40px Almarai";
                        ctx.fillText("Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø¹Ù‚Ø§Ø±", 30, 60);
                        res(canvas.toDataURL('image/jpeg', 0.7));
                    }
                }
            });
        }

        document.getElementById('propForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            btn.disabled = true; btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ø¯Ù…Ø¬...";

            const id = document.getElementById('editId').value;
            const files = document.getElementById('f_imgs').files;
            
            let newImgs = [];
            for (let f of files) newImgs.push(await compressImg(f));

            const finalImgsArray = [...currentEditImgs, ...newImgs]; // Ø¯Ù…Ø¬ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (ÙŠØ­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ø°Ù)

            const data = {
                type: document.getElementById('f_type').value,
                neigh: document.getElementById('f_neigh').value,
                area: document.getElementById('f_area').value,
                price: document.getElementById('f_price').value,
                status: document.getElementById('f_status').value,
                map: document.getElementById('f_map').value,
                details: document.getElementById('f_details').value,
                ownerName: document.getElementById('f_owner').value,
                ownerPhone: document.getElementById('f_phone').value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                imgs: finalImgsArray
            };

            if(id) await db.collection('properties').doc(id).update(data);
            else { data.views = 0; await db.collection('properties').add(data); }

            cancelEdit();
            loadData();
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
            btn.disabled = false; btn.innerText = "ğŸ’¾ Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±";
        };

        function editItem(id) {
            const item = allData.find(i => i.id === id);
            document.getElementById('editId').value = item.id;
            ['type','neigh','area','price','status','map','details'].forEach(k => document.getElementById('f_'+k).value = item[k] || '');
            document.getElementById('f_owner').value = item.ownerName || '';
            document.getElementById('f_phone').value = item.ownerPhone || '';
            
            currentEditImgs = item.imgs ? [...item.imgs] : [];
            renderEditImgs();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelEdit() {
            document.getElementById('propForm').reset();
            document.getElementById('editId').value = '';
            currentEditImgs = [];
            renderEditImgs();
        }

        async function deleteItem(id) {
            if(confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ")) { await db.collection('properties').doc(id).delete(); loadData(); }
        }

        function filterContent() {
            const v = document.getElementById('searchBox').value.toLowerCase();
            const type = document.getElementById('filterType').value;
            const filtered = allData.filter(i => {
                const matchT = (i.neigh && i.neigh.toLowerCase().includes(v)) || (i.type && i.type.toLowerCase().includes(v)) || (i.details && i.details.toLowerCase().includes(v));
                const matchF = type === 'Ø§Ù„ÙƒÙ„' || (i.type && i.type.includes(type));
                return matchT && matchF;
            });
            renderAll(filtered);
        }

        function setView(v) {
            document.getElementById('mainGrid').className = 'prop-grid ' + (v==='grid'?'grid-view':'list-view');
            document.getElementById('btnGrid').classList.toggle('active', v==='grid');
            document.getElementById('btnList').classList.toggle('active', v==='list');
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeBtn').innerText = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
        }
        
        function toggleLanguage() { alert("ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªÙ…Ø§Ø«Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨."); }

        function shareMe(t, n) { 
            if(navigator.share) navigator.share({title: t, text: `Ø¹Ù‚Ø§Ø± ÙÙŠ ${n}`, url: window.location.href});
            else alert("Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©: " + window.location.href);
        }

        loadData();
    </script>
</body>
</html>
