<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙƒØªØ¨ Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø¹Ù‚Ø§Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #113f28; --secondary: #d4af37; --bg: #f4f6f9; --card-bg: #ffffff;
            --text: #333; --border: #e0e0e0; --shadow: rgba(0,0,0,0.1);
        }
        [data-theme="dark"] {
            --primary: #1a5c3a; --secondary: #f1c40f; --bg: #121212; --card-bg: #1e1e1e;
            --text: #e0e0e0; --border: #444; --shadow: rgba(0,0,0,0.5);
        }
        body { font-family: 'Almarai', sans-serif; margin: 0; background-color: var(--bg); color: var(--text); transition: background-color 0.3s, color 0.3s; padding-bottom: 70px; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { background: linear-gradient(135deg, var(--primary), #0a291a); color: white; padding: 40px 20px; position: relative; text-align: center; border-bottom: 5px solid var(--secondary); }
        .logo { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--secondary); object-fit: cover; background: white; margin-bottom: 15px; }
        
        .top-nav { position: absolute; top: 15px; inset-inline-start: 15px; display: flex; gap: 10px; flex-wrap: wrap; z-index: 100; }
        .nav-btn { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-family: 'Almarai'; font-size: 14px; font-weight: bold; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
        .nav-btn:hover { background: var(--secondary); color: black; }

        .container { width: 95%; max-width: 1250px; margin: 25px auto; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† */
        #adminPanel { display: none; background: var(--card-bg); border: 2px solid var(--primary); padding: 30px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 10px 30px var(--shadow); }
        #adminPanel h2 { font-size: 26px; color: var(--primary); margin-top: 0; border-bottom: 2px solid var(--secondary); padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .admin-form-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .admin-input { padding: 16px; font-size: 16px; border: 2px solid var(--border); border-radius: 12px; font-family: 'Almarai'; background: var(--bg); color: var(--text); width: 100%; box-sizing: border-box; }
        .admin-input:focus { border-color: var(--secondary); outline: none; }
        textarea.admin-input { min-height: 120px; resize: vertical; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 15px; color: var(--primary); }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¬Ù†Ø¨Ø§Ù‹ Ø¥Ù„Ù‰ Ø¬Ù†Ø¨ */
        .form-actions { display: flex; gap: 15px; margin-top: 15px; }
        .btn-save { background: var(--primary); color: white; padding: 18px; border-radius: 12px; border: none; font-size: 18px; font-weight: bold; cursor: pointer; flex: 2; transition: 0.3s; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn-save:hover { background: #0a291a; transform: translateY(-2px); }
        .btn-cancel { background: transparent; color: var(--text); border: 1px solid var(--border); padding: 18px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; flex: 1; transition: 0.3s; font-family: 'Almarai'; }
        .btn-cancel:hover { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }

        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ± (Ù„Ù„Ù…ÙˆØ¸Ù) */
        #existingImgsContainer { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 10px; }
        .edit-img-wrapper { position: relative; flex-shrink: 0; }
        .edit-img-wrapper img { height: 100px; width: 100px; object-fit: cover; border-radius: 10px; border: 2px solid var(--border); }
        .edit-img-wrapper button { position: absolute; top: 5px; inset-inline-end: 5px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 2px solid var(--border); }
        .stat-item { background: var(--bg); border: 1px solid var(--border); padding: 20px; border-radius: 15px; text-align: center; }
        .stat-item span { display: block; font-size: 28px; font-weight: 800; color: var(--primary); margin-top: 5px; }

        /* Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ø¨Ø­Ø« */
        .toolbar { display: grid; grid-template-columns: 2fr 1fr auto; gap: 15px; margin-bottom: 25px; align-items: center; background: var(--card-bg); padding: 15px; border-radius: 15px; box-shadow: 0 4px 15px var(--shadow); border: 1px solid var(--border); }
        .search-bar, .filter-select { height: 50px; padding: 0 15px; border-radius: 10px; border: 2px solid var(--border); font-size: 16px; font-family: 'Almarai'; background: var(--bg); color: var(--text); box-sizing: border-box; width: 100%; }
        .view-icons { display: flex; gap: 10px; height: 50px; }
        .view-btn { background: var(--bg); color: var(--text); border: 2px solid var(--border); width: 50px; height: 50px; font-size: 20px; border-radius: 10px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; box-sizing: border-box; }
        .view-btn.active, .view-btn:hover { background: var(--secondary); color: black; border-color: var(--secondary); }
        @media (max-width: 768px) { .toolbar { grid-template-columns: 1fr; } .view-icons { justify-content: center; } }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø±Ø¶ */
        .prop-grid { display: grid; gap: 20px; transition: 0.3s; }
        .grid-view { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        .list-view { grid-template-columns: 1fr; }
        .list-view .prop-card { display: flex; flex-direction: row; align-items: stretch; }
        .list-view .prop-img { width: 280px; height: auto; min-height: 200px; }
        @media (max-width: 768px) { .list-view .prop-card { flex-direction: column; } .list-view .prop-img { width: 100%; height: 220px; } }

        .prop-card { background: var(--card-bg); border-radius: 15px; overflow: hidden; box-shadow: 0 6px 15px var(--shadow); border: 1px solid var(--border); position: relative; display: flex; flex-direction: column; }
        .prop-img { width: 100%; height: 220px; object-fit: cover; pointer-events: none; }
        .status-tag { position: absolute; top: 15px; inset-inline-end: 15px; padding: 6px 12px; border-radius: 20px; color: white; font-weight: bold; font-size: 13px; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .tag-avail { background: #27ae60; } .tag-sold { background: #c0392b; } .tag-arch { background: #7f8c8d; }
        .views-tag-secret { position: absolute; top: 15px; inset-inline-start: 15px; background: rgba(212, 175, 55, 0.9); color: black; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight:bold; z-index: 10; display: flex; align-items: center; gap: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }

        .prop-details { padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .price-text { font-size: 22px; font-weight: 800; color: var(--primary); margin: 8px 0; }
        [data-theme="dark"] .price-text { color: var(--secondary); }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ù…Ø© */
        .btn-action { padding: 12px; border-radius: 10px; border: none; font-family: 'Almarai'; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 14px; flex: 1; display:flex; justify-content:center; align-items:center; gap:5px; height: 45px; box-sizing: border-box; }
        .btn-main { background: var(--primary); color: white; }
        .btn-main:hover { background: #0a291a; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        [data-theme="dark"] .btn-outline { border-color: var(--secondary); color: var(--secondary); }
        
        .admin-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--border); }
        .btn-admin { padding: 10px; border-radius: 10px; font-family: 'Almarai'; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 14px; display:flex; justify-content:center; align-items:center; gap:5px; height: 45px; border: none; }
        .btn-edit { background: rgba(212, 175, 55, 0.15); color: #b8860b; border: 1px solid #d4af37; }
        .btn-edit:hover { background: #d4af37; color: white; }
        .btn-delete { background: rgba(231, 76, 60, 0.1); color: #e74c3c; border: 1px solid #e74c3c; }
        .btn-delete:hover { background: #e74c3c; color: white; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginModal { display:none; position:fixed; z-index:5000; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); align-items:center; justify-content:center; backdrop-filter: blur(5px); }
        .login-box { background:var(--card-bg); padding:40px; border-radius:20px; width:90%; max-width:400px; text-align:center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }

        /* Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø¨ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ø§Ø´Ø© (Lightbox) */
        #lightboxModal { display:none; position:fixed; z-index:6000; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); align-items:center; justify-content:center; backdrop-filter: blur(5px); }
        #lightboxImg { max-width: 90%; max-height: 85vh; border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.8); object-fit: contain; }
        .lightbox-close { position: absolute; top: 20px; inset-inline-end: 30px; font-size: 50px; color: white; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .lightbox-close:hover { color: var(--secondary); }
        .lightbox-nav { position: absolute; top: 50%; transform: translateY(-50%); font-size: 50px; color: white; background: rgba(0,0,0,0.5); border: none; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .lightbox-nav:hover { background: var(--secondary); color: black; }
        .lightbox-next { inset-inline-end: 20px; }
        .lightbox-prev { inset-inline-start: 20px; }

        .floating-wa { position: fixed; bottom: 25px; inset-inline-end: 25px; background: #25d366; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 32px; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); z-index: 1000; text-decoration: none; transition: transform 0.3s; }
        .floating-wa:hover { transform: scale(1.1); }
    </style>
</head>
<body data-theme="light" oncontextmenu="return false;">

    <div id="lightboxModal">
        <span class="lightbox-close" onclick="closeLightbox()">Ã—</span>
        <button class="lightbox-nav lightbox-prev" onclick="changeLightboxImg(-1)">&#10094;</button>
        <img id="lightboxImg" src="">
        <button class="lightbox-nav lightbox-next" onclick="changeLightboxImg(1)">&#10095;</button>
    </div>

    <a href="https://wa.me/966590002216" class="floating-wa" target="_blank" title="ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨">ğŸ’¬</a>

    <div id="loginModal">
        <div class="login-box">
            <h2 style="color:var(--primary)" data-i18n="loginTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <input type="text" id="userInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="admin-input" style="margin-bottom:15px">
            <input type="password" id="passInput" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ" class="admin-input" style="margin-bottom:20px">
            <button class="btn-save" onclick="checkLogin()" data-i18n="enter">Ø¯Ø®ÙˆÙ„</button>
            <button class="btn-cancel" onclick="closeLogin()" style="margin-top:10px; width:100%;" data-i18n="cancel">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <header>
        <div class="top-nav">
            <button class="nav-btn" onclick="toggleLanguage()" id="langBtn">ğŸŒ EN</button>
            <button class="nav-btn" onclick="toggleTheme()" id="themeBtn" style="font-size: 18px;">ğŸŒ™</button>
            <button class="nav-btn" onclick="window.open('https://maps.app.goo.gl/CYkchicmZwX2o9fe9')">ğŸ“ <span data-i18n="mapLocation">Ù…ÙˆÙ‚Ø¹ Ù…ÙƒØªØ¨Ù†Ø§</span></button>
            <button class="nav-btn" style="background:var(--secondary); color:black;" onclick="showLogin()" id="adminBtn">ğŸ‘¤ <span data-i18n="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span></button>
        </div>
        <img src="https://c.top4top.io/p_37048y9xn1.jpg" class="logo" alt="Logo">
        <h1 style="margin:0; font-size:32px;" data-i18n="mainTitle">Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø¹Ù‚Ø§Ø±</h1>
        <p style="margin:10px 0 0; opacity:0.9; font-size:18px;" data-i18n="subTitle">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
    </header>

    <div class="container">
        <div id="adminPanel">
            <h2 data-i18n="adminHeader">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±</h2>
            
            <form id="propForm">
                <input type="hidden" id="editId">
                <div class="admin-form-group">
                    <div><label data-i18n="l_type">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label><input type="text" id="f_type" class="admin-input" placeholder="ÙÙŠÙ„Ø§ØŒ Ø´Ù‚Ø©.." required></div>
                    <div><label data-i18n="l_neigh">Ø§Ù„Ø­ÙŠ</label><input type="text" id="f_neigh" class="admin-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ" required></div>
                    <div><label data-i18n="l_area">Ø§Ù„Ù…Ø³Ø§Ø­Ø©</label><input type="text" id="f_area" class="admin-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: 300Ù… Ø£Ùˆ ØºÙŠØ± Ù…Ø­Ø¯Ø¯"></div>
                    <div><label data-i18n="l_price">Ø§Ù„Ø³Ø¹Ø±</label><input type="text" id="f_price" class="admin-input" placeholder="Ù…Ø«Ø§Ù„: 1200000 Ø£Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ…" required></div>
                    
                    <div><label data-i18n="l_status">Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
                        <select id="f_status" class="admin-input">
                            <option value="Ù…ØªØ§Ø­">Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ø±Ø¶</option>
                            <option value="Ù…Ø¨Ø§Ø¹">Ù…Ø¨Ø§Ø¹</option>
                            <option value="Ù…Ø­Ø¬ÙˆØ²">Ù…Ø­Ø¬ÙˆØ²</option>
                            <option value="Ù…Ø¤Ø±Ø´Ù">Ù…Ø¤Ø±Ø´Ù (Ù…Ø®ÙÙŠ)</option>
                        </select>
                    </div>
                    <div><label data-i18n="l_map">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„)</label><input type="text" id="f_map" class="admin-input" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ"></div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label data-i18n="l_details">ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
                    <textarea id="f_details" class="admin-input" placeholder="Ø§ÙƒØªØ¨ Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±ÙØŒ Ø¹Ù…Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±ØŒ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©ØŒ Ø£Ùˆ Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø£Ø®Ø±Ù‰..."></textarea>
                </div>

                <div class="admin-form-group" style="background:rgba(212,175,55,0.05); padding:20px; border-radius:15px; border:1px dashed var(--secondary);">
                    <div><label data-i18n="l_owner">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø³Ø±ÙŠ)</label><input type="text" id="f_owner" class="admin-input"></div>
                    <div><label data-i18n="l_phone">Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø³Ø±ÙŠ)</label><input type="text" id="f_phone" class="admin-input"></div>
                    
                    <div style="grid-column: 1 / -1;">
                        <label>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ± (Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø­Ø°Ù)</label>
                        <div id="existingImgsContainer"></div>
                        <input type="file" id="f_imgs" multiple class="admin-input" accept="image/*">
                        <small style="color:gray;">*Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø³ØªÙ†Ø¶Ø§Ù Ù„Ù„ØµÙˆØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ø¥Ù† ÙˆØ¬Ø¯Øª). Ø³ÙŠØªÙ… Ø®ØªÙ…Ù‡Ø§ Ø¨Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</small>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-save" id="saveBtn"><span data-i18n="btnSave">ğŸ’¾ Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±</span></button>
                    <button type="button" class="btn-cancel" onclick="cancelEdit()" data-i18n="btnCancel">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
                </div>
            </form>

            <div class="stats-grid">
                <div class="stat-item"><span style="font-size:16px; font-weight:normal; color:var(--text);" data-i18n="s_total">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</span><span id="s_total">0</span></div>
                <div class="stat-item"><span style="font-size:16px; font-weight:normal; color:var(--text);" data-i18n="s_avail">Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ø±Ø¶</span><span id="s_avail">0</span></div>
                <div class="stat-item"><span style="font-size:16px; font-weight:normal; color:var(--text);" data-i18n="s_sold">Ø§Ù„Ù…Ø¨Ø§Ø¹</span><span id="s_sold">0</span></div>
            </div>
            
            <div style="text-align:center; margin-top:20px;">
                <button onclick="exportFullBackup()" style="background:#007bff; color:white; padding:12px 25px; border-radius:10px; border:none; cursor:pointer; font-weight:bold; font-family:'Almarai';">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>

        <div class="toolbar">
            <input type="text" id="searchBox" class="search-bar" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­ÙŠ Ø£Ùˆ ØªÙØ§ØµÙŠÙ„..." onkeyup="filterContent()">
            
            <select id="filterType" class="filter-select" onchange="filterContent()">
                <option value="Ø§Ù„ÙƒÙ„" data-i18n="f_all">ÙƒÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</option>
                <option value="ÙÙŠÙ„Ø§" data-i18n="f_villa">ÙÙ„Ù„</option>
                <option value="Ø´Ù‚Ø©" data-i18n="f_apt">Ø´Ù‚Ù‚</option>
                <option value="Ø£Ø±Ø¶" data-i18n="f_land">Ø£Ø±Ø§Ø¶ÙŠ</option>
                <option value="Ø¹Ù…Ø§Ø±Ø©" data-i18n="f_bldg">Ø¹Ù…Ø§Ø±Ø§Øª</option>
                <option value="Ù…Ø²Ø±Ø¹Ø©" data-i18n="f_farm">Ù…Ø²Ø§Ø±Ø¹</option>
            </select>

            <div class="view-icons">
                <button class="view-btn active" id="btnGrid" onclick="setView('grid')" title="Ø¹Ø±Ø¶ ÙƒØ±ÙˆØª">â¬œ</button>
                <button class="view-btn" id="btnList" onclick="setView('list')" title="Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø©">â˜°</button>
            </div>
        </div>

        <div id="mainGrid" class="prop-grid grid-view"></div>
    </div>

    <div id="detailsModal" style="display:none; position:fixed; z-index:4000; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); overflow-y:auto; backdrop-filter: blur(5px);">
        <div style="background:var(--card-bg); margin:40px auto; width:95%; max-width:800px; border-radius:20px; padding:30px; position:relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
            <span onclick="this.parentElement.parentElement.style.display='none'" style="position:absolute; inset-inline-start:20px; top:15px; font-size:35px; cursor:pointer; color:var(--text); z-index: 10;">Ã—</span>
            <div id="detailsContent"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAbzqda0NFaj3nAotHK9_1exNqNDeRASxk",
            authDomain: "alfateh-aqar.firebaseapp.com",
            projectId: "alfateh-aqar",
            storageBucket: "alfateh-aqar.firebasestorage.app",
            messagingSenderId: "170214550520",
            appId: "1:170214550520:web:638dfbc62ea5edc7cc040d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let isAdmin = false;
        let allData = [];
        let currentLang = 'ar';
        let currentEditImgs = []; // Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØ± Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        let lightboxImgs = []; // Ù„ØªØµÙØ­ Ø§Ù„ØµÙˆØ±
        let lightboxIndex = 0;

        const dict = {
            ar: {
                loginBtn: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„", mapLocation: "Ù…ÙˆÙ‚Ø¹ Ù…ÙƒØªØ¨Ù†Ø§", mainTitle: "Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø¹Ù‚Ø§Ø±", subTitle: "Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„",
                loginTitle: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„", enter: "Ø¯Ø®ÙˆÙ„", cancel: "Ø¥Ù„ØºØ§Ø¡",
                adminHeader: "âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±",
                l_type: "Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±", l_neigh: "Ø§Ù„Ø­ÙŠ", l_area: "Ø§Ù„Ù…Ø³Ø§Ø­Ø©", l_price: "Ø§Ù„Ø³Ø¹Ø±", l_status: "Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±", l_map: "Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„)", l_details: "ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±", l_owner: "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø³Ø±ÙŠ)", l_phone: "Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø³Ø±ÙŠ)", btnSave: "ğŸ’¾ Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±", btnCancel: "Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„",
                s_total: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª", s_avail: "Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ø±Ø¶", s_sold: "Ø§Ù„Ù…Ø¨Ø§Ø¹",
                f_all: "ÙƒÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª", f_villa: "ÙÙ„Ù„", f_apt: "Ø´Ù‚Ù‚", f_land: "Ø£Ø±Ø§Ø¶ÙŠ", f_bldg: "Ø¹Ù…Ø§Ø±Ø§Øª", f_farm: "Ù…Ø²Ø§Ø±Ø¹",
                ui_area: "Ø§Ù„Ù…Ø³Ø§Ø­Ø©", ui_details: "Ø§Ù„ØªÙØ§ØµÙŠÙ„", ui_share: "Ù…Ø´Ø§Ø±ÙƒØ©", ui_edit: "ØªØ¹Ø¯ÙŠÙ„", ui_delete: "Ø­Ø°Ù", ui_status: "Ø§Ù„Ø­Ø§Ù„Ø©", ui_price: "Ø§Ù„Ø³Ø¹Ø±", ui_whatsapp: "ÙˆØ§ØªØ³Ø§Ø¨"
            },
            en: {
                loginBtn: "Login", mapLocation: "Our Location", mainTitle: "Al Fateh Real Estate", subTitle: "Integrated Management System",
                loginTitle: "Admin Login", enter: "Enter", cancel: "Cancel",
                adminHeader: "âš™ï¸ Control Panel & Add Property",
                l_type: "Property Type", l_neigh: "Neighborhood", l_area: "Area", l_price: "Price", l_status: "Status", l_map: "Google Maps Link", l_details: "Property Details", l_owner: "Owner Name (Secret)", l_phone: "Owner Phone (Secret)", btnSave: "ğŸ’¾ Save & Publish", btnCancel: "Cancel Edit",
                s_total: "Total Props", s_avail: "Available", s_sold: "Sold",
                f_all: "All Properties", f_villa: "Villas", f_apt: "Apartments", f_land: "Lands", f_bldg: "Buildings", f_farm: "Farms",
                ui_area: "Area", ui_details: "Details", ui_share: "Share", ui_edit: "Edit", ui_delete: "Delete", ui_status: "Status", ui_price: "Price", ui_whatsapp: "WhatsApp"
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('langBtn').innerText = currentLang === 'ar' ? 'ğŸŒ EN' : 'ğŸŒ AR';
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[currentLang][key]) el.innerText = dict[currentLang][key];
            });
            
            document.getElementById('searchBox').placeholder = currentLang === 'ar' ? "ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­ÙŠ Ø£Ùˆ ØªÙØ§ØµÙŠÙ„..." : "ğŸ” Search neighborhood...";
            renderAll(); 
        }

        function showLogin() { 
            if(isAdmin) { isAdmin=false; location.reload(); }
            else { document.getElementById('loginModal').style.display='flex'; }
        }
        function closeLogin() { document.getElementById('loginModal').style.display='none'; }
        
        function checkLogin() {
            if(document.getElementById('userInput').value === "admin" && document.getElementById('passInput').value === "1234") {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'block';
                document.querySelector('[data-i18n="loginBtn"]').innerText = currentLang === 'ar' ? "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬" : "Logout";
                closeLogin();
                renderAll();
            } else { alert(currentLang === 'ar' ? "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©!" : "Invalid credentials!"); }
        }

        function setView(v) { 
            document.getElementById('mainGrid').className = 'prop-grid ' + (v==='grid'?'grid-view':'list-view');
            document.getElementById('btnGrid').classList.toggle('active', v==='grid');
            document.getElementById('btnList').classList.toggle('active', v==='list');
        }

        function toggleTheme() { 
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeBtn').innerText = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        async function loadData() {
            document.getElementById('mainGrid').innerHTML = '<h3 style="text-align:center; grid-column: 1/-1;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>';
            const snap = await db.collection('properties').orderBy('timestamp', 'desc').get();
            allData = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
            updateStats();
            renderAll();
        }

        function updateStats() {
            document.getElementById('s_total').innerText = allData.length;
            document.getElementById('s_avail').innerText = allData.filter(i => i.status === 'Ù…ØªØ§Ø­').length;
            document.getElementById('s_sold').innerText = allData.filter(i => i.status === 'Ù…Ø¨Ø§Ø¹').length;
        }

        function renderAll(data = allData) {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = '';
            const t = dict[currentLang]; 
            
            data.forEach(item => {
                if(item.status === 'Ù…Ø¤Ø±Ø´Ù' && !isAdmin) return;
                
                const statusClass = item.status === 'Ù…ØªØ§Ø­' ? 'tag-avail' : (item.status === 'Ù…Ø¨Ø§Ø¹' ? 'tag-sold' : 'tag-arch');
                let displayStatus = item.status;
                if(currentLang === 'en') {
                    if(item.status === 'Ù…ØªØ§Ø­') displayStatus = 'Available';
                    if(item.status === 'Ù…Ø¨Ø§Ø¹') displayStatus = 'Sold';
                    if(item.status === 'Ù…Ø­Ø¬ÙˆØ²') displayStatus = 'Reserved';
                    if(item.status === 'Ù…Ø¤Ø±Ø´Ù') displayStatus = 'Archived';
                }

                const card = document.createElement('div');
                card.className = 'prop-card';
                card.innerHTML = `
                    ${isAdmin ? `<div class="views-tag-secret" title="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª">ğŸ‘ï¸ ${item.views || 0}</div>` : ''}
                    <div class="status-tag ${statusClass}">${displayStatus}</div>
                    <img src="${(item.imgs && item.imgs[0]) || 'https://via.placeholder.com/400x250'}" class="prop-img" loading="lazy">
                    <div class="prop-details">
                        <div>
                            <div style="font-size:14px; opacity:0.7;">ğŸ“ ${item.neigh}</div>
                            <h3 style="margin:8px 0;">${item.type}</h3>
                            <div class="price-text">${item.price}</div>
                            <div style="font-size:14px; margin-bottom:15px; color:#7f8c8d;">ğŸ“ ${t.ui_area}: ${item.area || '-'}</div>
                        </div>
                        <div>
                            <div style="display:flex; gap:10px;">
                                <button class="btn-action btn-main" onclick="openDetails('${item.id}')">${t.ui_details}</button>
                                <button class="btn-action btn-outline" onclick="shareMe('${item.type}','${item.neigh}')">ğŸ”— ${t.ui_share}</button>
                            </div>
                            ${isAdmin ? `
                                <div class="admin-actions">
                                    <button onclick="editItem('${item.id}')" class="btn-admin btn-edit">âœï¸ ${t.ui_edit}</button>
                                    <button onclick="deleteItem('${item.id}')" class="btn-admin btn-delete">ğŸ—‘ï¸ ${t.ui_delete}</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        /* --- Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Lightbox) --- */
        function openLightbox(idx) {
            lightboxIndex = idx;
            document.getElementById('lightboxImg').src = lightboxImgs[lightboxIndex];
            document.getElementById('lightboxModal').style.display = 'flex';
        }
        function closeLightbox() {
            document.getElementById('lightboxModal').style.display = 'none';
        }
        function changeLightboxImg(step) {
            lightboxIndex += step;
            if (lightboxIndex >= lightboxImgs.length) lightboxIndex = 0;
            if (lightboxIndex < 0) lightboxIndex = lightboxImgs.length - 1;
            document.getElementById('lightboxImg').src = lightboxImgs[lightboxIndex];
        }

        async function openDetails(id) {
            const item = allData.find(i => i.id === id);
            const t = dict[currentLang];
            
            if(!isAdmin) {
                await db.collection('properties').doc(id).update({ views: firebase.firestore.FieldValue.increment(1) });
                item.views = (item.views || 0) + 1; 
                renderAll(); 
            }

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙˆØ± Ù„Ù„Ù€ Lightbox
            lightboxImgs = item.imgs || [];
            let imgGallery = '<div style="display:flex; overflow-x:auto; gap:10px; margin-bottom:20px; padding-bottom:10px; scroll-snap-type: x mandatory;">';
            lightboxImgs.forEach((src, idx) => {
                imgGallery += `<img src="${src}" onclick="openLightbox(${idx})" title="Ø§Ø¶ØºØ· Ù„ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©" style="height:280px; width:auto; border-radius:15px; scroll-snap-align: start; cursor:pointer; border: 1px solid var(--border); transition: 0.2s;" onmouseover="this.style.opacity=0.8" onmouseout="this.style.opacity=1">`;
            });
            imgGallery += '</div>';

            let adminSec = '';
            if(isAdmin) {
                adminSec = `<div style="background:rgba(212,175,55,0.1); padding:20px; border-radius:15px; margin:20px 0; border:1px dashed var(--secondary);">
                    <h4 style="margin:0 0 10px 0; color:var(--primary);">ğŸ”’ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§ØµØ© (Ù„Ù„Ù…ÙˆØ¸Ù ÙÙ‚Ø·):</h4>
                    <p style="margin:5px 0;"><b>ğŸ‘ï¸ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª:</b> ${item.views || 0}</p>
                    <p style="margin:5px 0;"><b>ğŸ‘¤ Ø§Ù„Ù…Ø§Ù„Ùƒ:</b> ${item.ownerName || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                    <p style="margin:5px 0;"><b>ğŸ“± Ø§Ù„Ø¬ÙˆØ§Ù„:</b> ${item.ownerPhone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                </div>`;
            }

            document.getElementById('detailsContent').innerHTML = `
                ${imgGallery}
                <h2 style="color:var(--primary); margin-bottom:10px;">${item.type} - ${item.neigh}</h2>
                
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                    <div style="font-size: 26px; font-weight: 800; color: var(--secondary);">${item.price}</div>
                    <div style="font-size: 16px; font-weight: bold; color: var(--text); background: var(--bg); padding: 8px 15px; border-radius: 12px; border: 1px solid var(--border);">ğŸ“ ${t.ui_area}: ${item.area || '-'}</div>
                </div>
                
                <div style="background: var(--bg); padding: 20px; border-radius: 15px; margin-bottom: 20px; line-height: 1.8; font-size: 16px;">
                    <h4 style="margin-top:0; color:var(--primary); border-bottom:1px solid var(--border); padding-bottom:8px;">${t.l_details}</h4>
                    ${item.details ? item.details.replace(/\n/g, '<br>') : (currentLang==='ar'?'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©.':'No additional details.')}
                </div>

                <div style="font-size:16px;">
                    <p><b>${t.ui_status}:</b> <span class="status-tag" style="position:static; display:inline-block; margin-inline-start:10px; background:${item.status === 'Ù…ØªØ§Ø­' ? '#27ae60' : (item.status === 'Ù…Ø¨Ø§Ø¹' ? '#c0392b' : '#7f8c8d')}">${item.status}</span></p>
                </div>
                
                ${adminSec}
                
                <div style="display:flex; gap:15px; margin-top:30px;">
                    <a href="https://wa.me/966590002216?text=Ø§Ø³ØªÙØ³Ø§Ø± Ø¨Ø®ØµÙˆØµ ${item.type} ÙÙŠ ${item.neigh} Ø¨Ø³Ø¹Ø± ${item.price}" target="_blank" style="flex:1; background:#25d366; color:white; text-align:center; padding:18px; border-radius:12px; text-decoration:none; font-weight:bold; font-size:16px; display:flex; justify-content:center; align-items:center; gap:8px;">ğŸ’¬ ${t.ui_whatsapp}</a>
                    ${item.map ? `<a href="${item.map}" target="_blank" style="flex:1; background:#4285F4; color:white; text-align:center; padding:18px; border-radius:12px; text-decoration:none; font-weight:bold; font-size:16px;">ğŸ“ ${currentLang==='ar'?'Ø§Ù„Ù…ÙˆÙ‚Ø¹':'Map'}</a>` : ''}
                </div>
            `;
            document.getElementById('detailsModal').style.display = 'block';
        }

        async function compressImg(file) {
            return new Promise(res => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = e => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const maxW = 1000; 
                        canvas.width = maxW;
                        canvas.height = img.height * (maxW / img.width);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        
                        ctx.fillStyle = "rgba(255, 255, 255, 0.4)"; 
                        ctx.font = "bold 50px Almarai";
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        ctx.fillText("Ø­ÙŠ Ø§Ù„ÙØªØ­ Ù„Ù„Ø¹Ù‚Ø§Ø±", canvas.width / 2, canvas.height / 2);

                        res(canvas.toDataURL('image/jpeg', 0.7));
                    }
                }
            });
        }

        /* --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ± Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- */
        function renderExistingImgs() {
            const container = document.getElementById('existingImgsContainer');
            if (currentEditImgs.length === 0) {
                container.innerHTML = '';
                return;
            }
            let html = '';
            currentEditImgs.forEach((src, idx) => {
                html += `
                <div class="edit-img-wrapper">
                    <img src="${src}">
                    <button type="button" onclick="removeEditImg(${idx})" title="Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©">Ã—</button>
                </div>`;
            });
            container.innerHTML = html;
        }

        function removeEditImg(idx) {
            currentEditImgs.splice(idx, 1); // Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
            renderExistingImgs(); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±
        }

        document.getElementById('propForm').onsubmit = async (e) => {
            e.preventDefault();
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";

            const id = document.getElementById('editId').value;
            const files = document.getElementById('f_imgs').files;
            
            // Ø¶ØºØ· Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            let newImgs = [];
            for (let f of files) newImgs.push(await compressImg(f));

            // Ø¯Ù…Ø¬ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ø¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            let finalImgs = [...currentEditImgs, ...newImgs];

            const data = {
                type: document.getElementById('f_type').value,
                neigh: document.getElementById('f_neigh').value,
                area: document.getElementById('f_area').value, 
                price: document.getElementById('f_price').value, 
                status: document.getElementById('f_status').value,
                map: document.getElementById('f_map').value,
                details: document.getElementById('f_details').value, 
                ownerName: document.getElementById('f_owner').value,
                ownerPhone: document.getElementById('f_phone').value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if(!id) data.views = 0; 
            if(finalImgs.length > 0) data.imgs = finalImgs;

            if(id) await db.collection('properties').doc(id).update(data);
            else await db.collection('properties').add(data);
            
            cancelEdit(); // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙÙˆØ±Ù…
            loadData();
            alert(currentLang === 'ar' ? 'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!' : 'Saved successfully!');
        };

        function editItem(id) { 
            const item = allData.find(i => i.id === id);
            document.getElementById('editId').value = item.id;
            document.getElementById('f_type').value = item.type || '';
            document.getElementById('f_neigh').value = item.neigh || '';
            document.getElementById('f_area').value = item.area || '';
            document.getElementById('f_price').value = item.price || '';
            document.getElementById('f_status').value = item.status || 'Ù…ØªØ§Ø­';
            document.getElementById('f_map').value = item.map || '';
            document.getElementById('f_details').value = item.details || '';
            document.getElementById('f_owner').value = item.ownerName || '';
            document.getElementById('f_phone').value = item.ownerPhone || '';
            
            // Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¹Ø´Ø§Ù† ÙŠÙ‚Ø¯Ø± ÙŠØ­Ø°Ù Ù…Ù†Ù‡Ø§
            currentEditImgs = item.imgs ? [...item.imgs] : [];
            renderExistingImgs();

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function cancelEdit() { 
            document.getElementById('propForm').reset(); 
            document.getElementById('editId').value = ''; 
            currentEditImgs = [];
            renderExistingImgs();
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = false;
            saveBtn.innerHTML = dict[currentLang].btnSave;
        }

        async function deleteItem(id) { 
            if(confirm(currentLang === 'ar' ? "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ" : "Are you sure you want to delete?")) { 
                await db.collection('properties').doc(id).delete(); 
                loadData(); 
            } 
        }

        function filterContent() {
            const v = document.getElementById('searchBox').value.toLowerCase();
            const typeFilter = document.getElementById('filterType').value;
            
            const filtered = allData.filter(i => {
                const matchText = (i.neigh && i.neigh.toLowerCase().includes(v)) || 
                                  (i.type && i.type.toLowerCase().includes(v)) ||
                                  (i.details && i.details.toLowerCase().includes(v));
                const matchType = (typeFilter === 'Ø§Ù„ÙƒÙ„') || (i.type && i.type.includes(typeFilter));
                return matchText && matchType;
            });
            renderAll(filtered);
        }

        function shareMe(t, n) { 
            const url = window.location.href;
            if(navigator.share) navigator.share({title: t, text: `Ø¹Ù‚Ø§Ø± ÙÙŠ ${n}`, url: url});
            else alert(currentLang === 'ar' ? "Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·: " + url : "Copy this link: " + url);
        }

        function exportFullBackup() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allData, null, 2));
            const dl = document.createElement('a');
            dl.setAttribute("href", dataStr);
            dl.setAttribute("download", "Backup_" + new Date().toISOString().slice(0,10) + ".json");
            dl.click();
        }

        loadData();
    </script>
</body>
</html>
